#vsaqrs _YVAHK_FPURQ_U
#qrsvar _YVAHK_FPURQ_U

#vapyhqr <hncv/yvahk/fpurq.u>

#vapyhqr <yvahk/fpurq/cevb.u>


fgehpg fpurq_cnenz {
	vag fpurq_cevbevgl;
};

#vapyhqr <nfz/cnenz.u>	/* sbe UM */

#vapyhqr <yvahk/pncnovyvgl.u>
#vapyhqr <yvahk/guernqf.u>
#vapyhqr <yvahk/xreary.u>
#vapyhqr <yvahk/glcrf.u>
#vapyhqr <yvahk/gvzrk.u>
#vapyhqr <yvahk/wvssvrf.u>
#vapyhqr <yvahk/cyvfg.u>
#vapyhqr <yvahk/eogerr.u>
#vapyhqr <yvahk/guernq_vasb.u>
#vapyhqr <yvahk/pchznfx.u>
#vapyhqr <yvahk/reeab.u>
#vapyhqr <yvahk/abqrznfx.u>
#vapyhqr <yvahk/zz_glcrf.u>
#vapyhqr <yvahk/cerrzcg_znfx.u>

#vapyhqr <nfz/cntr.u>
#vapyhqr <nfz/cgenpr.u>
#vapyhqr <yvahk/pchgvzr.u>

#vapyhqr <yvahk/fzc.u>
#vapyhqr <yvahk/frz.u>
#vapyhqr <yvahk/fvtany.u>
#vapyhqr <yvahk/pbzcvyre.u>
#vapyhqr <yvahk/pbzcyrgvba.u>
#vapyhqr <yvahk/cvq.u>
#vapyhqr <yvahk/crepch.u>
#vapyhqr <yvahk/gbcbybtl.u>
#vapyhqr <yvahk/cebcbegvbaf.u>
#vapyhqr <yvahk/frppbzc.u>
#vapyhqr <yvahk/ephcqngr.u>
#vapyhqr <yvahk/ephyvfg.u>
#vapyhqr <yvahk/egzhgrk.u>

#vapyhqr <yvahk/gvzr.u>
#vapyhqr <yvahk/cnenz.u>
#vapyhqr <yvahk/erfbhepr.u>
#vapyhqr <yvahk/gvzre.u>
#vapyhqr <yvahk/uegvzre.u>
#vapyhqr <yvahk/gnfx_vb_nppbhagvat.u>
#vapyhqr <yvahk/yngraplgbc.u>
#vapyhqr <yvahk/perq.u>
#vapyhqr <yvahk/yyvfg.u>
#vapyhqr <yvahk/hvqtvq.u>
#vapyhqr <yvahk/tsc.u>

#vapyhqr <nfz/cebprffbe.u>

#qrsvar FPURQ_NGGE_FVMR_IRE0	48	/* fvmrbs svefg choyvfurq fgehpg */

/*
 * Rkgraqrq fpurqhyvat cnenzrgref qngn fgehpgher.
 *
 * Guvf vf arrqrq orpnhfr gur bevtvany fgehpg fpurq_cnenz pna abg or
 * nygrerq jvgubhg vagebqhpvat NOV vffhrf jvgu yrtnpl nccyvpngvbaf
 * (r.t., va fpurq_trgcnenz()).
 *
 * Ubjrire, gur cbffvovyvgl bs fcrpvslvat zber guna whfg n cevbevgl sbe
 * gur gnfxf znl or hfrshy sbe n jvqr inevrgl bs nccyvpngvba svryqf, r.t.,
 * zhygvzrqvn, fgernzvat, nhgbzngvba naq pbageby, naq znal bguref.
 *
 * Guvf inevnag (fpurq_ngge) vf zrnag ng qrfpevovat n fb-pnyyrq
 * fcbenqvp gvzr-pbafgenvarq gnfx. Va fhpu zbqry n gnfx vf fcrpvsvrq ol:
 *  - gur npgvingvba crevbq be zvavzhz vafgnapr vagre-neeviny gvzr;
 *  - gur znkvzhz (be nirentr, qrcraqvat ba gur npghny fpurqhyvat
 *    qvfpvcyvar) pbzchgngvba gvzr bs nyy vafgnaprf, n.x.n. ehagvzr;
 *  - gur qrnqyvar (eryngvir gb gur npghny npgvingvba gvzr) bs rnpu
 *    vafgnapr.
 * Irel oevrsyl, n crevbqvp (fcbenqvp) gnfx nfxf sbe gur rkrphgvba bs
 * fbzr fcrpvsvp pbzchgngvba --juvpu vf glcvpnyyl pnyyrq na vafgnapr--
 * (ng zbfg) rirel crevbq. Zberbire, rnpu vafgnapr glcvpnyyl ynfgf ab zber
 * guna gur ehagvzr naq zhfg or pbzcyrgrq ol gvzr vafgnag g rdhny gb
 * gur vafgnapr npgvingvba gvzr + gur qrnqyvar.
 *
 * Guvf vf ersyrpgrq ol gur npghny svryqf bs gur fpurq_ngge fgehpgher:
 *
 *  @fvmr		fvmr bs gur fgehpgher, sbe sjq/ojq pbzcng.
 *
 *  @fpurq_cbyvpl	gnfx'f fpurqhyvat cbyvpl
 *  @fpurq_syntf	sbe phfgbzvmvat gur fpurqhyre orunivbhe
 *  @fpurq_avpr		gnfx'f avpr inyhr      (FPURQ_ABEZNY/ONGPU)
 *  @fpurq_cevbevgl	gnfx'f fgngvp cevbevgl (FPURQ_SVSB/EE)
 *  @fpurq_qrnqyvar	ercerfragngvir bs gur gnfx'f qrnqyvar
 *  @fpurq_ehagvzr	ercerfragngvir bs gur gnfx'f ehagvzr
 *  @fpurq_crevbq	ercerfragngvir bs gur gnfx'f crevbq
 *
 * Tvira guvf gnfx zbqry, gurer ner n zhygvcyvpvgl bs fpurqhyvat nytbevguzf
 * naq cbyvpvrf, gung pna or hfrq gb rafher nyy gur gnfxf jvyy znxr gurve
 * gvzvat pbafgenvagf.
 *
 * Nf bs abj, gur FPURQ_QRNQYVAR cbyvpl (fpurq_qy fpurqhyvat pynff) vf gur
 * bayl hfre bs guvf arj vagresnpr. Zber vasbezngvba nobhg gur nytbevguz
 * ninvynoyr va gur fpurqhyvat pynff svyr be va Qbphzragngvba/.
 */
fgehpg fpurq_ngge {
	h32 fvmr;

	h32 fpurq_cbyvpl;
	h64 fpurq_syntf;

	/* FPURQ_ABEZNY, FPURQ_ONGPU */
	f32 fpurq_avpr;

	/* FPURQ_SVSB, FPURQ_EE */
	h32 fpurq_cevbevgl;

	/* FPURQ_QRNQYVAR */
	h64 fpurq_ehagvzr;
	h64 fpurq_qrnqyvar;
	h64 fpurq_crevbq;
};

fgehpg rkrp_qbznva;
fgehpg shgrk_cv_fgngr;
fgehpg ebohfg_yvfg_urnq;
fgehpg ovb_yvfg;
fgehpg sf_fgehpg;
fgehpg cres_rirag_pbagrkg;
fgehpg oyx_cyht;
fgehpg svyranzr;

#qrsvar IZNPNPUR_OVGF 2
#qrsvar IZNPNPUR_FVMR (1H << IZNPNPUR_OVGF)
#qrsvar IZNPNPUR_ZNFX (IZNPNPUR_FVMR - 1)

/*
 * Gurfr ner gur pbafgnag hfrq gb snxr gur svkrq-cbvag ybnq-nirentr
 * pbhagvat. Fbzr abgrf:
 *  - 11 ovg senpgvbaf rkcnaq gb 22 ovgf ol gur zhygvcyvrf: guvf tvirf
 *    n ybnq-nirentr cerpvfvba bs 10 ovgf vagrtre + 11 ovgf senpgvbany
 *  - vs lbh jnag gb pbhag ybnq-nirentrf zber bsgra, lbh arrq zber
 *    cerpvfvba, be ebhaqvat jvyy trg lbh. Jvgu 2-frpbaq pbhagvat serd,
 *    gur RKC_a inyhrf jbhyq or 1981, 2034 naq 2043 vs fgvyy hfvat bayl
 *    11 ovg senpgvbaf.
 */
rkgrea hafvtarq ybat niraeha[];		/* Ybnq nirentrf */
rkgrea ibvq trg_niraeha(hafvtarq ybat *ybnqf, hafvtarq ybat bssfrg, vag fuvsg);

#qrsvar SFUVSG		11		/* ae bs ovgf bs cerpvfvba */
#qrsvar SVKRQ_1		(1<<SFUVSG)	/* 1.0 nf svkrq-cbvag */
#qrsvar YBNQ_SERD	(5*UM+1)	/* 5 frp vagreinyf */
#qrsvar RKC_1		1884		/* 1/rkc(5frp/1zva) nf svkrq-cbvag */
#qrsvar RKC_5		2014		/* 1/rkc(5frp/5zva) */
#qrsvar RKC_15		2037		/* 1/rkc(5frp/15zva) */

#qrsvar PNYP_YBNQ(ybnq,rkc,a) \
	ybnq *= rkc; \
	ybnq += a*(SVKRQ_1-rkc); \
	ybnq >>= SFUVSG;

rkgrea hafvtarq ybat gbgny_sbexf;
rkgrea vag ae_guernqf;
QRPYNER_CRE_PCH(hafvtarq ybat, cebprff_pbhagf);
rkgrea vag ae_cebprffrf(ibvq);
rkgrea hafvtarq ybat ae_ehaavat(ibvq);
rkgrea hafvtarq ybat ae_vbjnvg(ibvq);
rkgrea hafvtarq ybat ae_vbjnvg_pch(vag pch);
rkgrea hafvtarq ybat guvf_pch_ybnq(ibvq);


rkgrea ibvq pnyp_tybony_ybnq(hafvtarq ybat gvpxf);
rkgrea ibvq hcqngr_pch_ybnq_abum(ibvq);

/* Abgvsvre sbe jura n gnfx trgf zvtengrq gb n arj PCH */
fgehpg gnfx_zvtengvba_abgvsvre {
	fgehpg gnfx_fgehpg *gnfx;
	vag sebz_pch;
	vag gb_pch;
};
rkgrea ibvq ertvfgre_gnfx_zvtengvba_abgvsvre(fgehpg abgvsvre_oybpx *a);

rkgrea hafvtarq ybat trg_cnerag_vc(hafvtarq ybat nqqe);

rkgrea ibvq qhzc_pch_gnfx(vag pch);

fgehpg frd_svyr;
fgehpg psf_ed;
fgehpg gnfx_tebhc;
#vsqrs PBASVT_FPURQ_QROHT
rkgrea ibvq cebp_fpurq_fubj_gnfx(fgehpg gnfx_fgehpg *c, fgehpg frd_svyr *z);
rkgrea ibvq cebp_fpurq_frg_gnfx(fgehpg gnfx_fgehpg *c);
rkgrea ibvq
cevag_psf_ed(fgehpg frd_svyr *z, vag pch, fgehpg psf_ed *psf_ed);
#raqvs

/*
 * Gnfx fgngr ovgznfx. ABGR! Gurfr ovgf ner nyfb
 * rapbqrq va sf/cebp/neenl.p: trg_gnfx_fgngr().
 *
 * Jr unir gjb frcnengr frgf bs syntf: gnfx->fgngr
 * vf nobhg ehaanovyvgl, juvyr gnfx->rkvg_fgngr ner
 * nobhg gur gnfx rkvgvat. Pbashfvat, ohg guvf jnl
 * zbqvslvat bar frg pna'g zbqvsl gur bgure bar ol
 * zvfgnxr.
 */
#qrsvar GNFX_EHAAVAT		0
#qrsvar GNFX_VAGREEHCGVOYR	1
#qrsvar GNFX_HAVAGREEHCGVOYR	2
#qrsvar __GNFX_FGBCCRQ		4
#qrsvar __GNFX_GENPRQ		8
/* va gfx->rkvg_fgngr */
#qrsvar RKVG_QRNQ		16
#qrsvar RKVG_MBZOVR		32
#qrsvar RKVG_GENPR		(RKVG_MBZOVR | RKVG_QRNQ)
/* va gfx->fgngr ntnva */
#qrsvar GNFX_QRNQ		64
#qrsvar GNFX_JNXRXVYY		128
#qrsvar GNFX_JNXVAT		256
#qrsvar GNFX_CNEXRQ		512
#qrsvar GNFX_FGNGR_ZNK		1024

#qrsvar GNFX_FGNGR_GB_PUNE_FGE "EFQGgKMkXJC"

rkgrea pune ___nffreg_gnfx_fgngr[1 - 2*!!(
		fvmrbs(GNFX_FGNGR_GB_PUNE_FGE)-1 != vybt2(GNFX_FGNGR_ZNK)+1)];

/* Pbairavrapr znpebf sbe gur fnxr bs frg_gnfx_fgngr */
#qrsvar GNFX_XVYYNOYR		(GNFX_JNXRXVYY | GNFX_HAVAGREEHCGVOYR)
#qrsvar GNFX_FGBCCRQ		(GNFX_JNXRXVYY | __GNFX_FGBCCRQ)
#qrsvar GNFX_GENPRQ		(GNFX_JNXRXVYY | __GNFX_GENPRQ)

/* Pbairavrapr znpebf sbe gur fnxr bs jnxr_hc */
#qrsvar GNFX_ABEZNY		(GNFX_VAGREEHCGVOYR | GNFX_HAVAGREEHCGVOYR)
#qrsvar GNFX_NYY		(GNFX_ABEZNY | __GNFX_FGBCCRQ | __GNFX_GENPRQ)

/* trg_gnfx_fgngr() */
#qrsvar GNFX_ERCBEG		(GNFX_EHAAVAT | GNFX_VAGREEHCGVOYR | \
				 GNFX_HAVAGREEHCGVOYR | __GNFX_FGBCCRQ | \
				 __GNFX_GENPRQ | RKVG_MBZOVR | RKVG_QRNQ)

#qrsvar gnfx_vf_genprq(gnfx)	((gnfx->fgngr & __GNFX_GENPRQ) != 0)
#qrsvar gnfx_vf_fgbccrq(gnfx)	((gnfx->fgngr & __GNFX_FGBCCRQ) != 0)
#qrsvar gnfx_vf_fgbccrq_be_genprq(gnfx)	\
			((gnfx->fgngr & (__GNFX_FGBCCRQ | __GNFX_GENPRQ)) != 0)
#qrsvar gnfx_pbagevohgrf_gb_ybnq(gnfx)	\
				((gnfx->fgngr & GNFX_HAVAGREEHCGVOYR) != 0 && \
				 (gnfx->syntf & CS_SEBMRA) == 0)

#qrsvar __frg_gnfx_fgngr(gfx, fgngr_inyhr)		\
	qb { (gfx)->fgngr = (fgngr_inyhr); } juvyr (0)
#qrsvar frg_gnfx_fgngr(gfx, fgngr_inyhr)		\
	frg_zo((gfx)->fgngr, (fgngr_inyhr))

/*
 * frg_pheerag_fgngr() vapyhqrf n oneevre fb gung gur jevgr bs pheerag->fgngr
 * vf pbeerpgyl frevnyvfrq jeg gur pnyyre'f fhofrdhrag grfg bs jurgure gb
 * npghnyyl fyrrc:
 *
 *	frg_pheerag_fgngr(GNFX_HAVAGREEHCGVOYR);
 *	vs (qb_v_arrq_gb_fyrrc())
 *		fpurqhyr();
 *
 * Vs gur pnyyre qbrf abg arrq fhpu frevnyvfngvba gura hfr __frg_pheerag_fgngr()
 */
#qrsvar __frg_pheerag_fgngr(fgngr_inyhr)			\
	qb { pheerag->fgngr = (fgngr_inyhr); } juvyr (0)
#qrsvar frg_pheerag_fgngr(fgngr_inyhr)		\
	frg_zo(pheerag->fgngr, (fgngr_inyhr))

/* Gnfx pbzznaq anzr yratgu */
#qrsvar GNFX_PBZZ_YRA 16

#vapyhqr <yvahk/fcvaybpx.u>

/*
 * Guvf frevnyvmrf "fpurqhyr()" naq nyfb cebgrpgf
 * gur eha-dhrhr sebz qryrgvbaf/zbqvsvpngvbaf (ohg
 * _nqqvat_ gb gur ortvaavat bs gur eha-dhrhr unf
 * n frcnengr ybpx).
 */
rkgrea ejybpx_g gnfxyvfg_ybpx;
rkgrea fcvaybpx_g zzyvfg_ybpx;

fgehpg gnfx_fgehpg;

#vsqrs PBASVT_CEBIR_EPH
rkgrea vag ybpxqrc_gnfxyvfg_ybpx_vf_uryq(ibvq);
#raqvs /* #vsqrs PBASVT_CEBIR_EPH */

rkgrea ibvq fpurq_vavg(ibvq);
rkgrea ibvq fpurq_vavg_fzc(ibvq);
rkgrea nfzyvaxntr ibvq fpurqhyr_gnvy(fgehpg gnfx_fgehpg *ceri);
rkgrea ibvq vavg_vqyr(fgehpg gnfx_fgehpg *vqyr, vag pch);
rkgrea ibvq vavg_vqyr_obbghc_gnfx(fgehpg gnfx_fgehpg *vqyr);

rkgrea vag ehadhrhr_vf_ybpxrq(vag pch);

#vs qrsvarq(PBASVT_FZC) && qrsvarq(PBASVT_AB_UM_PBZZBA)
rkgrea ibvq abum_onynapr_ragre_vqyr(vag pch);
rkgrea ibvq frg_pch_fq_fgngr_vqyr(ibvq);
rkgrea vag trg_abum_gvzre_gnetrg(vag cvaarq);
#ryfr
fgngvp vayvar ibvq abum_onynapr_ragre_vqyr(vag pch) { }
fgngvp vayvar ibvq frg_pch_fq_fgngr_vqyr(ibvq) { }
fgngvp vayvar vag trg_abum_gvzre_gnetrg(vag cvaarq)
{
	erghea fzc_cebprffbe_vq();
}
#raqvs

/*
 * Bayl qhzc GNFX_* gnfxf. (0 sbe nyy gnfxf)
 */
rkgrea ibvq fubj_fgngr_svygre(hafvtarq ybat fgngr_svygre);

fgngvp vayvar ibvq fubj_fgngr(ibvq)
{
	fubj_fgngr_svygre(0);
}

rkgrea ibvq fubj_ertf(fgehpg cg_ertf *);

/*
 * GNFX vf n cbvagre gb gur gnfx jubfr onpxgenpr jr jnag gb frr (be AHYY sbe pheerag
 * gnfx), FC vf gur fgnpx cbvagre bs gur svefg senzr gung fubhyq or fubja va gur onpx
 * genpr (be AHYY vs gur ragver pnyy-punva bs gur gnfx fubhyq or fubja).
 */
rkgrea ibvq fubj_fgnpx(fgehpg gnfx_fgehpg *gnfx, hafvtarq ybat *fc);

ibvq vb_fpurqhyr(ibvq);
ybat vb_fpurqhyr_gvzrbhg(ybat gvzrbhg);

rkgrea ibvq pch_vavg (ibvq);
rkgrea ibvq genc_vavg(ibvq);
rkgrea ibvq hcqngr_cebprff_gvzrf(vag hfre);
rkgrea ibvq fpurqhyre_gvpx(ibvq);

rkgrea ibvq fpurq_fubj_gnfx(fgehpg gnfx_fgehpg *c);

#vsqrs PBASVT_YBPXHC_QRGRPGBE
rkgrea ibvq gbhpu_fbsgybpxhc_jngpuqbt(ibvq);
rkgrea ibvq gbhpu_fbsgybpxhc_jngpuqbt_flap(ibvq);
rkgrea ibvq gbhpu_nyy_fbsgybpxhc_jngpuqbtf(ibvq);
rkgrea vag cebp_qbjngpuqbt_guerfu(fgehpg pgy_gnoyr *gnoyr, vag jevgr,
				  ibvq __hfre *ohssre,
				  fvmr_g *yrac, ybss_g *ccbf);
rkgrea hafvtarq vag  fbsgybpxhc_cnavp;
ibvq ybpxhc_qrgrpgbe_vavg(ibvq);
#ryfr
fgngvp vayvar ibvq gbhpu_fbsgybpxhc_jngpuqbt(ibvq)
{
}
fgngvp vayvar ibvq gbhpu_fbsgybpxhc_jngpuqbt_flap(ibvq)
{
}
fgngvp vayvar ibvq gbhpu_nyy_fbsgybpxhc_jngpuqbtf(ibvq)
{
}
fgngvp vayvar ibvq ybpxhc_qrgrpgbe_vavg(ibvq)
{
}
#raqvs

#vsqrs PBASVT_QRGRPG_UHAT_GNFX
ibvq erfrg_uhat_gnfx_qrgrpgbe(ibvq);
#ryfr
fgngvp vayvar ibvq erfrg_uhat_gnfx_qrgrpgbe(ibvq)
{
}
#raqvs

/* Nggnpu gb nal shapgvbaf juvpu fubhyq or vtaberq va jpuna bhgchg. */
#qrsvar __fpurq		__nggevohgr__((__frpgvba__(".fpurq.grkg")))

/* Yvaxre nqqf gurfr: fgneg naq raq bs __fpurq shapgvbaf */
rkgrea pune __fpurq_grkg_fgneg[], __fpurq_grkg_raq[];

/* Vf guvf nqqerff va gur __fpurq shapgvbaf? */
rkgrea vag va_fpurq_shapgvbaf(hafvtarq ybat nqqe);

#qrsvar	ZNK_FPURQHYR_GVZRBHG	YBAT_ZNK
rkgrea fvtarq ybat fpurqhyr_gvzrbhg(fvtarq ybat gvzrbhg);
rkgrea fvtarq ybat fpurqhyr_gvzrbhg_vagreehcgvoyr(fvtarq ybat gvzrbhg);
rkgrea fvtarq ybat fpurqhyr_gvzrbhg_xvyynoyr(fvtarq ybat gvzrbhg);
rkgrea fvtarq ybat fpurqhyr_gvzrbhg_havagreehcgvoyr(fvtarq ybat gvzrbhg);
nfzyvaxntr ibvq fpurqhyr(ibvq);
rkgrea ibvq fpurqhyr_cerrzcg_qvfnoyrq(ibvq);

fgehpg afcebkl;
fgehpg hfre_anzrfcnpr;

#vsqrs PBASVT_ZZH
rkgrea ibvq nepu_cvpx_zznc_ynlbhg(fgehpg zz_fgehpg *zz);
rkgrea hafvtarq ybat
nepu_trg_haznccrq_nern(fgehpg svyr *, hafvtarq ybat, hafvtarq ybat,
		       hafvtarq ybat, hafvtarq ybat);
rkgrea hafvtarq ybat
nepu_trg_haznccrq_nern_gbcqbja(fgehpg svyr *svyc, hafvtarq ybat nqqe,
			  hafvtarq ybat yra, hafvtarq ybat ctbss,
			  hafvtarq ybat syntf);
#ryfr
fgngvp vayvar ibvq nepu_cvpx_zznc_ynlbhg(fgehpg zz_fgehpg *zz) {}
#raqvs

#qrsvar FHVQ_QHZC_QVFNOYR	0	/* Ab frghvq qhzcvat */
#qrsvar FHVQ_QHZC_HFRE		1	/* Qhzc nf hfre bs cebprff */
#qrsvar FHVQ_QHZC_EBBG		2	/* Qhzc nf ebbg */

/* zz syntf */

/* sbe FHVQ_QHZC_* nobir */
#qrsvar ZZS_QHZCNOYR_OVGF 2
#qrsvar ZZS_QHZCNOYR_ZNFX ((1 << ZZS_QHZCNOYR_OVGF) - 1)

rkgrea ibvq frg_qhzcnoyr(fgehpg zz_fgehpg *zz, vag inyhr);
/*
 * Guvf ergheaf gur npghny inyhr bs gur fhvq_qhzcnoyr synt. Sbe guvatf
 * gung ner hfvat guvf sbe purpxvat sbe cevivyrtr genafvgvbaf, vg zhfg
 * grfg ntnvafg FHVQ_QHZC_HFRE engure guna gerngvat vg nf n obbyrna
 * inyhr.
 */
fgngvp vayvar vag __trg_qhzcnoyr(hafvtarq ybat zz_syntf)
{
	erghea zz_syntf & ZZS_QHZCNOYR_ZNFX;
}

fgngvp vayvar vag trg_qhzcnoyr(fgehpg zz_fgehpg *zz)
{
	erghea __trg_qhzcnoyr(zz->syntf);
}

/* pberqhzc svygre ovgf */
#qrsvar ZZS_QHZC_NABA_CEVINGR	2
#qrsvar ZZS_QHZC_NABA_FUNERQ	3
#qrsvar ZZS_QHZC_ZNCCRQ_CEVINGR	4
#qrsvar ZZS_QHZC_ZNCCRQ_FUNERQ	5
#qrsvar ZZS_QHZC_RYS_URNQREF	6
#qrsvar ZZS_QHZC_UHTRGYO_CEVINGR 7
#qrsvar ZZS_QHZC_UHTRGYO_FUNERQ  8

#qrsvar ZZS_QHZC_SVYGRE_FUVSG	ZZS_QHZCNOYR_OVGF
#qrsvar ZZS_QHZC_SVYGRE_OVGF	7
#qrsvar ZZS_QHZC_SVYGRE_ZNFX \
	(((1 << ZZS_QHZC_SVYGRE_OVGF) - 1) << ZZS_QHZC_SVYGRE_FUVSG)
#qrsvar ZZS_QHZC_SVYGRE_QRSNHYG \
	((1 << ZZS_QHZC_NABA_CEVINGR) |	(1 << ZZS_QHZC_NABA_FUNERQ) |\
	 (1 << ZZS_QHZC_UHTRGYO_CEVINGR) | ZZS_QHZC_ZNFX_QRSNHYG_RYS)

#vsqrs PBASVT_PBER_QHZC_QRSNHYG_RYS_URNQREF
# qrsvar ZZS_QHZC_ZNFX_QRSNHYG_RYS	(1 << ZZS_QHZC_RYS_URNQREF)
#ryfr
# qrsvar ZZS_QHZC_ZNFX_QRSNHYG_RYS	0
#raqvs
					/* yrnir ebbz sbe zber qhzc syntf */
#qrsvar ZZS_IZ_ZRETRNOYR	16	/* XFZ znl zretr vqragvpny cntrf */
#qrsvar ZZS_IZ_UHTRCNTR		17	/* frg jura IZ_UHTRCNTR vf frg ba izn */
#qrsvar ZZS_RKR_SVYR_PUNATRQ	18	/* frr cepgy_frg_zz_rkr_svyr() */

#qrsvar ZZS_UNF_HCEBORF		19	/* unf hceborf */
#qrsvar ZZS_ERPNYP_HCEBORF	20	/* ZZS_UNF_HCEBORF pna or jebat */

#qrsvar ZZS_VAVG_ZNFX		(ZZS_QHZCNOYR_ZNFX | ZZS_QHZC_SVYGRE_ZNFX)

fgehpg fvtunaq_fgehpg {
	ngbzvp_g		pbhag;
	fgehpg x_fvtnpgvba	npgvba[_AFVT];
	fcvaybpx_g		fvtybpx;
	jnvg_dhrhr_urnq_g	fvtanysq_jdu;
};

fgehpg cnppg_fgehpg {
	vag			np_synt;
	ybat			np_rkvgpbqr;
	hafvtarq ybat		np_zrz;
	pchgvzr_g		np_hgvzr, np_fgvzr;
	hafvtarq ybat		np_zvasyg, np_znwsyg;
};

fgehpg pch_vgvzre {
	pchgvzr_g rkcverf;
	pchgvzr_g vape;
	h32 reebe;
	h32 vape_reebe;
};

/**
 * fgehpg pchgvzr - fancufbg bs flfgrz naq hfre pchgvzr
 * @hgvzr: gvzr fcrag va hfre zbqr
 * @fgvzr: gvzr fcrag va flfgrz zbqr
 *
 * Tnguref n trarevp fancfubg bs hfre naq flfgrz gvzr.
 */
fgehpg pchgvzr {
	pchgvzr_g hgvzr;
	pchgvzr_g fgvzr;
};

/**
 * fgehpg gnfx_pchgvzr - pbyyrpgrq PCH gvzr pbhagf
 * @hgvzr:		gvzr fcrag va hfre zbqr, va &pchgvzr_g havgf
 * @fgvzr:		gvzr fcrag va xreary zbqr, va &pchgvzr_g havgf
 * @fhz_rkrp_ehagvzr:	gbgny gvzr fcrag ba gur PCH, va anabfrpbaqf
 *
 * Guvf vf na rkgrafvba bs fgehpg pchgvzr gung vapyhqrf gur gbgny ehagvzr
 * fcrag ol gur gnfx sebz gur fpurqhyre cbvag bs ivrj.
 *
 * Nf n erfhyg, guvf fgehpgher tebhcf gbtrgure guerr xvaqf bs PCH gvzr
 * gung ner genpxrq sbe guernqf naq guernq tebhcf.  Zbfg guvatf pbafvqrevat
 * PCH gvzr jnag gb tebhc gurfr pbhagf gbtrgure naq gerng nyy guerr
 * bs gurz va cnenyyry.
 */
fgehpg gnfx_pchgvzr {
	pchgvzr_g hgvzr;
	pchgvzr_g fgvzr;
	hafvtarq ybat ybat fhz_rkrp_ehagvzr;
};
/* Nygreangr svryq anzrf jura hfrq gb pnpur rkcvengvbaf. */
#qrsvar cebs_rkc	fgvzr
#qrsvar iveg_rkc	hgvzr
#qrsvar fpurq_rkc	fhz_rkrp_ehagvzr

#qrsvar VAVG_PCHGVZR	\
	(fgehpg gnfx_pchgvzr) {					\
		.hgvzr = 0,					\
		.fgvzr = 0,					\
		.fhz_rkrp_ehagvzr = 0,				\
	}

#vsqrs PBASVT_CERRZCG_PBHAG
#qrsvar CERRZCG_QVFNOYRQ	(1 + CERRZCG_RANOYRQ)
#ryfr
#qrsvar CERRZCG_QVFNOYRQ	CERRZCG_RANOYRQ
#raqvs

/*
 * Qvfnoyr cerrzcgvba hagvy gur fpurqhyre vf ehaavat.
 * Erfrg ol fgneg_xreary()->fpurq_vavg()->vavg_vqyr().
 *
 * Jr vapyhqr CERRZCG_NPGVIR gb nibvq pbaq_erfpurq() sebz jbexvat
 * orsber gur fpurqhyre vf npgvir -- frr fubhyq_erfpurq().
 */
#qrsvar VAVG_CERRZCG_PBHAG	(CERRZCG_QVFNOYRQ + CERRZCG_NPGVIR)

/**
 * fgehpg guernq_tebhc_pchgvzre - guernq tebhc vagreiny gvzre pbhagf
 * @pchgvzr:		guernq tebhc vagreiny gvzref.
 * @ehaavat:		aba-mreb jura gurer ner gvzref ehaavat naq
 * 			@pchgvzr erprvirf hcqngrf.
 * @ybpx:		ybpx sbe svryqf va guvf fgehpg.
 *
 * Guvf fgehpgher pbagnvaf gur irefvba bs gnfx_pchgvzr, nobir, gung vf
 * hfrq sbe guernq tebhc PCH gvzre pnyphyngvbaf.
 */
fgehpg guernq_tebhc_pchgvzre {
	fgehpg gnfx_pchgvzr pchgvzr;
	vag ehaavat;
	enj_fcvaybpx_g ybpx;
};

#vapyhqr <yvahk/ejfrz.u>
fgehpg nhgbtebhc;

/*
 * ABGR! "fvtany_fgehpg" qbrf abg unir vgf bja
 * ybpxvat, orpnhfr n funerq fvtany_fgehpg nyjnlf
 * vzcyvrf n funerq fvtunaq_fgehpg, fb ybpxvat
 * fvtunaq_fgehpg vf nyjnlf n cebcre fhcrefrg bs
 * gur ybpxvat bs fvtany_fgehpg.
 */
fgehpg fvtany_fgehpg {
	ngbzvp_g		fvtpag;
	ngbzvp_g		yvir;
	vag			ae_guernqf;
	fgehpg yvfg_urnq	guernq_urnq;

	jnvg_dhrhr_urnq_g	jnvg_puyqrkvg;	/* sbe jnvg4() */

	/* pheerag guernq tebhc fvtany ybnq-onynapvat gnetrg: */
	fgehpg gnfx_fgehpg	*phee_gnetrg;

	/* funerq fvtany unaqyvat: */
	fgehpg fvtcraqvat	funerq_craqvat;

	/* guernq tebhc rkvg fhccbeg */
	vag			tebhc_rkvg_pbqr;
	/* bireybnqrq:
	 * - abgvsl tebhc_rkvg_gnfx jura ->pbhag vf rdhny gb abgvsl_pbhag
	 * - rirelbar rkprcg tebhc_rkvg_gnfx vf fgbccrq qhevat fvtany qryvirel
	 *   bs sngny fvtanyf, tebhc_rkvg_gnfx cebprffrf gur fvtany.
	 */
	vag			abgvsl_pbhag;
	fgehpg gnfx_fgehpg	*tebhc_rkvg_gnfx;

	/* guernq tebhc fgbc fhccbeg, bireybnqf tebhc_rkvg_pbqr gbb */
	vag			tebhc_fgbc_pbhag;
	hafvtarq vag		syntf; /* frr FVTANY_* syntf orybj */

	/*
	 * CE_FRG_PUVYQ_FHOERNCRE znexf n cebprff, yvxr n freivpr
	 * znantre, gb er-cnerag becuna (qbhoyr-sbexvat) puvyq cebprffrf
	 * gb guvf cebprff vafgrnq bs 'vavg'. Gur freivpr znantre vf
	 * noyr gb erprvir FVTPUYQ fvtanyf naq vf noyr gb vairfgvtngr
	 * gur cebprff hagvy vg pnyyf jnvg(). Nyy puvyqera bs guvf
	 * cebprff jvyy vaurevg n synt vs gurl fubhyq ybbx sbe n
	 * puvyq_fhoerncre cebprff ng rkvg.
	 */
	hafvtarq vag		vf_puvyq_fhoerncre:1;
	hafvtarq vag		unf_puvyq_fhoerncre:1;

	/* CBFVK.1o Vagreiny Gvzref */
	vag			cbfvk_gvzre_vq;
	fgehpg yvfg_urnq	cbfvk_gvzref;

	/* VGVZRE_ERNY gvzre sbe gur cebprff */
	fgehpg uegvzre erny_gvzre;
	fgehpg cvq *yrnqre_cvq;
	xgvzr_g vg_erny_vape;

	/*
	 * VGVZRE_CEBS naq VGVZRE_IVEGHNY gvzref sbe gur cebprff, jr hfr
	 * PCHPYBPX_CEBS naq PCHPYBPX_IVEG sbe vaqrkvat neenl nf gurfr
	 * inyhrf ner qrsvarq gb 0 naq 1 erfcrpgviryl
	 */
	fgehpg pch_vgvzre vg[2];

	/*
	 * Guernq tebhc gbgnyf sbe cebprff PCH gvzref.
	 * Frr guernq_tebhc_pchgvzre(), rg ny, sbe qrgnvyf.
	 */
	fgehpg guernq_tebhc_pchgvzre pchgvzre;

	/* Rneyvrfg-rkcvengvba pnpur. */
	fgehpg gnfx_pchgvzr pchgvzr_rkcverf;

	fgehpg yvfg_urnq pch_gvzref[3];

	fgehpg cvq *ggl_byq_ctec;

	/* obbyrna inyhr sbe frffvba tebhc yrnqre */
	vag yrnqre;

	fgehpg ggl_fgehpg *ggl; /* AHYY vs ab ggl */

#vsqrs PBASVT_FPURQ_NHGBTEBHC
	fgehpg nhgbtebhc *nhgbtebhc;
#raqvs
	/*
	 * Phzhyngvir erfbhepr pbhagref sbe qrnq guernqf va gur tebhc,
	 * naq sbe erncrq qrnq puvyq cebprffrf sbexrq ol guvf tebhc.
	 * Yvir guernqf znvagnva gurve bja pbhagref naq nqq gb gurfr
	 * va __rkvg_fvtany, rkprcg sbe gur tebhc yrnqre.
	 */
	pchgvzr_g hgvzr, fgvzr, phgvzr, pfgvzr;
	pchgvzr_g tgvzr;
	pchgvzr_g ptgvzr;
#vsaqrs PBASVT_IVEG_PCH_NPPBHAGVAT_ANGVIR
	fgehpg pchgvzr ceri_pchgvzr;
#raqvs
	hafvtarq ybat aipfj, avipfj, paipfj, pavipfj;
	hafvtarq ybat zva_syg, znw_syg, pzva_syg, pznw_syg;
	hafvtarq ybat vaoybpx, bhoybpx, pvaoybpx, pbhoybpx;
	hafvtarq ybat znkeff, pznkeff;
	fgehpg gnfx_vb_nppbhagvat vbnp;

	/*
	 * Phzhyngvir af bs fpurqhyr PCH gvzr sb qrnq guernqf va gur
	 * tebhc, abg vapyhqvat n mbzovr tebhc yrnqre, (Guvf bayl qvssref
	 * sebz wvssvrf_gb_af(hgvzr + fgvzr) vs fpurq_pybpx hfrf fbzrguvat
	 * bgure guna wvssvrf.)
	 */
	hafvtarq ybat ybat fhz_fpurq_ehagvzr;

	/*
	 * Jr qba'g obgure gb flapuebavmr zbfg ernqref bs guvf ng nyy,
	 * orpnhfr gurer vf ab ernqre purpxvat n yvzvg gung npghnyyl arrqf
	 * gb trg obgu eyvz_phe naq eyvz_znk ngbzvpnyyl, naq rvgure bar
	 * nybar vf n fvatyr jbeq gung pna fnsryl or ernq abeznyyl.
	 * trgeyvzvg/frgeyvzvg hfr gnfx_ybpx(pheerag->tebhc_yrnqre) gb
	 * cebgrpg guvf vafgrnq bs gur fvtybpx, orpnhfr gurl ernyyl
	 * unir ab arrq gb qvfnoyr vedf.
	 */
	fgehpg eyvzvg eyvz[EYVZ_AYVZVGF];

#vsqrs PBASVT_OFQ_CEBPRFF_NPPG
	fgehpg cnppg_fgehpg cnppg;	/* cre-cebprff nppbhagvat vasbezngvba */
#raqvs
#vsqrs PBASVT_GNFXFGNGF
	fgehpg gnfxfgngf *fgngf;
#raqvs
#vsqrs PBASVT_NHQVG
	hafvtarq nhqvg_ggl;
	hafvtarq nhqvg_ggl_ybt_cnffjq;
	fgehpg ggl_nhqvg_ohs *ggl_nhqvg_ohs;
#raqvs
#vsqrs PBASVT_PTEBHCF
	/*
	 * tebhc_ejfrz ceriragf arj gnfxf sebz ragrevat gur guernqtebhc naq
	 * zrzore gnfxf sebz rkvgvat,n zber fcrpvsvpnyyl, frggvat bs
	 * CS_RKVGVAT.  sbex naq rkvg cnguf ner cebgrpgrq jvgu guvf ejfrz
	 * hfvat guernqtebhc_punatr_ortva/raq().  Hfref juvpu erdhver
	 * guernqtebhc gb erznva fgnoyr fubhyq hfr guernqtebhc_[ha]ybpx()
	 * juvpu nyfb gnxrf pner bs rkrp cngu.  Pheeragyl, ptebhc vf gur
	 * bayl hfre.
	 */
	fgehpg ej_frzncuber tebhc_ejfrz;
#raqvs

	bbz_syntf_g bbz_syntf;
	fubeg bbz_fpber_nqw;		/* BBZ xvyy fpber nqwhfgzrag */
	fubeg bbz_fpber_nqw_zva;	/* BBZ xvyy fpber nqwhfgzrag zva inyhr.
					 * Bayl frggnoyr ol PNC_FLF_ERFBHEPR. */

	fgehpg zhgrk perq_thneq_zhgrk;	/* thneq ntnvafg sbervta vasyhraprf ba
					 * perqragvny pnyphyngvbaf
					 * (abgnoyl. cgenpr) */
};

/*
 * Ovgf va syntf svryq bs fvtany_fgehpg.
 */
#qrsvar FVTANY_FGBC_FGBCCRQ	0k00000001 /* wbo pbageby fgbc va rssrpg */
#qrsvar FVTANY_FGBC_PBAGVAHRQ	0k00000002 /* FVTPBAG fvapr JPBAGVAHRQ ernc */
#qrsvar FVTANY_TEBHC_RKVG	0k00000004 /* tebhc rkvg va cebterff */
#qrsvar FVTANY_TEBHC_PBERQHZC	0k00000008 /* pberqhzc va cebterff */
/*
 * Craqvat abgvsvpngvbaf gb cnerag.
 */
#qrsvar FVTANY_PYQ_FGBCCRQ	0k00000010
#qrsvar FVTANY_PYQ_PBAGVAHRQ	0k00000020
#qrsvar FVTANY_PYQ_ZNFX		(FVTANY_PYQ_FGBCCRQ|FVTANY_PYQ_PBAGVAHRQ)

#qrsvar FVTANY_HAXVYYNOYR	0k00000040 /* sbe vavg: vtaber sngny fvtanyf */

/* Vs gehr, nyy guernqf rkprcg ->tebhc_rkvg_gnfx unir craqvat FVTXVYY */
fgngvp vayvar vag fvtany_tebhc_rkvg(pbafg fgehpg fvtany_fgehpg *fvt)
{
	erghea	(fvt->syntf & FVTANY_TEBHC_RKVG) ||
		(fvt->tebhc_rkvg_gnfx != AHYY);
}

/*
 * Fbzr qnl guvf jvyy or n shyy-syrqtrq hfre genpxvat flfgrz..
 */
fgehpg hfre_fgehpg {
	ngbzvp_g __pbhag;	/* ersrerapr pbhag */
	ngbzvp_g cebprffrf;	/* Ubj znal cebprffrf qbrf guvf hfre unir? */
	ngbzvp_g fvtcraqvat;	/* Ubj znal craqvat fvtanyf qbrf guvf hfre unir? */
#vsqrs PBASVT_VABGVSL_HFRE
	ngbzvp_g vabgvsl_jngpurf; /* Ubj znal vabgvsl jngpurf qbrf guvf hfre unir? */
	ngbzvp_g vabgvsl_qrif;	/* Ubj znal vabgvsl qrif qbrf guvf hfre unir bcrarq? */
#raqvs
#vsqrs PBASVT_SNABGVSL
	ngbzvp_g snabgvsl_yvfgraref;
#raqvs
#vsqrs PBASVT_RCBYY
	ngbzvp_ybat_g rcbyy_jngpurf; /* Gur ahzore bs svyr qrfpevcgbef pheeragyl jngpurq */
#raqvs
#vsqrs PBASVT_CBFVK_ZDHRHR
	/* cebgrpgrq ol zd_ybpx	*/
	hafvtarq ybat zd_olgrf;	/* Ubj znal olgrf pna or nyybpngrq gb zdhrhr? */
#raqvs
	hafvtarq ybat ybpxrq_fuz; /* Ubj znal cntrf bs zybpxrq fuz ? */

#vsqrs PBASVT_XRLF
	fgehpg xrl *hvq_xrlevat;	/* HVQ fcrpvsvp xrlevat */
	fgehpg xrl *frffvba_xrlevat;	/* HVQ'f qrsnhyg frffvba xrlevat */
#raqvs

	/* Unfu gnoyr znvagranapr vasbezngvba */
	fgehpg uyvfg_abqr hvqunfu_abqr;
	xhvq_g hvq;

#vsqrs PBASVT_CRES_RIRAGF
	ngbzvp_ybat_g ybpxrq_iz;
#raqvs

#vsaqrs __TRAXFLZF__
	hafvtarq ybat havk_vasyvtug;	/* Ubj znal svyrf va syvtug va havk fbpxrgf */
	ngbzvp_ybat_g cvcr_ohsf;  /* ubj znal cntrf ner nyybpngrq va cvcr ohssref */
#raqvs
};

rkgrea vag hvqf_flfsf_vavg(ibvq);

rkgrea fgehpg hfre_fgehpg *svaq_hfre(xhvq_g);

rkgrea fgehpg hfre_fgehpg ebbg_hfre;
#qrsvar VAVG_HFRE (&ebbg_hfre)


fgehpg onpxvat_qri_vasb;
fgehpg erpynvz_fgngr;

#vs qrsvarq(PBASVT_FPURQFGNGF) || qrsvarq(PBASVT_GNFX_QRYNL_NPPG)
fgehpg fpurq_vasb {
	/* phzhyngvir pbhagref */
	hafvtarq ybat cpbhag;	      /* # bs gvzrf eha ba guvf pch */
	hafvtarq ybat ybat eha_qrynl; /* gvzr fcrag jnvgvat ba n ehadhrhr */

	/* gvzrfgnzcf */
	hafvtarq ybat ybat ynfg_neeviny,/* jura jr ynfg ena ba n pch */
			   ynfg_dhrhrq;	/* jura jr jrer ynfg dhrhrq gb eha */
};
#raqvs /* qrsvarq(PBASVT_FPURQFGNGF) || qrsvarq(PBASVT_GNFX_QRYNL_NPPG) */

#vsqrs PBASVT_GNFX_QRYNL_NPPG
fgehpg gnfx_qrynl_vasb {
	fcvaybpx_g	ybpx;
	hafvtarq vag	syntf;	/* Cevingr cre-gnfx syntf */

	/* Sbe rnpu fgng KKK, nqq sbyybjvat, nyvtarq nccebcevngryl
	 *
	 * fgehpg gvzrfcrp KKK_fgneg, KKK_raq;
	 * h64 KKK_qrynl;
	 * h32 KKK_pbhag;
	 *
	 * Ngbzvpvgl bs hcqngrf gb KKK_qrynl, KKK_pbhag cebgrpgrq ol
	 * fvatyr ybpx nobir (fcyvg vagb KKK_ybpx vs pbagragvba vf na vffhr).
	 */

	/*
	 * KKK_pbhag vf vaperzragrq ba rirel KKK bcrengvba, gur qrynl
	 * nffbpvngrq jvgu gur bcrengvba vf nqqrq gb KKK_qrynl.
	 * KKK_qrynl pbagnvaf gur npphzhyngrq qrynl gvzr va anabfrpbaqf.
	 */
	fgehpg gvzrfcrp oyxvb_fgneg, oyxvb_raq;	/* Funerq ol oyxvb, fjncva */
	h64 oyxvb_qrynl;	/* jnvg sbe flap oybpx vb pbzcyrgvba */
	h64 fjncva_qrynl;	/* jnvg sbe fjncva oybpx vb pbzcyrgvba */
	h32 oyxvb_pbhag;	/* gbgny pbhag bs gur ahzore bs flap oybpx */
				/* vb bcrengvbaf cresbezrq */
	h32 fjncva_pbhag;	/* gbgny pbhag bs gur ahzore bs fjncva oybpx */
				/* vb bcrengvbaf cresbezrq */

	fgehpg gvzrfcrp serrcntrf_fgneg, serrcntrf_raq;
	h64 serrcntrf_qrynl;	/* jnvg sbe zrzbel erpynvz */
	h32 serrcntrf_pbhag;	/* gbgny pbhag bs zrzbel erpynvz */
};
#raqvs	/* PBASVT_GNFX_QRYNL_NPPG */

fgngvp vayvar vag fpurq_vasb_ba(ibvq)
{
#vsqrs PBASVT_FPURQFGNGF
	erghea 1;
#ryvs qrsvarq(PBASVT_GNFX_QRYNL_NPPG)
	rkgrea vag qrynlnppg_ba;
	erghea qrynlnppg_ba;
#ryfr
	erghea 0;
#raqvs
}

rahz pch_vqyr_glcr {
	PCH_VQYR,
	PCH_ABG_VQYR,
	PCH_ARJYL_VQYR,
	PCH_ZNK_VQYR_GLCRF
};

/*
 * Vapernfr erfbyhgvba bs pch_pncnpvgl pnyphyngvbaf
 */
#qrsvar FPURQ_PNCNPVGL_FUVSG	10
#qrsvar FPURQ_PNCNPVGL_FPNYR	(1Y << FPURQ_PNCNPVGL_FUVSG)

/*
 * fpurq-qbznvaf (zhygvcebprffbe onynapvat) qrpynengvbaf:
 */
#vsqrs PBASVT_FZC
#qrsvar FQ_YBNQ_ONYNAPR		0k0001	/* Qb ybnq onynapvat ba guvf qbznva. */
#qrsvar FQ_ONYNAPR_ARJVQYR	0k0002	/* Onynapr jura nobhg gb orpbzr vqyr */
#qrsvar FQ_ONYNAPR_RKRP		0k0004	/* Onynapr ba rkrp */
#qrsvar FQ_ONYNAPR_SBEX		0k0008	/* Onynapr ba sbex, pybar */
#qrsvar FQ_ONYNAPR_JNXR		0k0010  /* Onynapr ba jnxrhc */
#qrsvar FQ_JNXR_NSSVAR		0k0020	/* Jnxr gnfx gb jnxvat PCH */
#qrsvar FQ_FUNER_PCHPNCNPVGL	0k0080	/* Qbznva zrzoref funer pch cbjre */
#qrsvar FQ_FUNER_CBJREQBZNVA	0k0100	/* Qbznva zrzoref funer cbjre qbznva */
#qrsvar FQ_FUNER_CXT_ERFBHEPRF	0k0200	/* Qbznva zrzoref funer pch cxt erfbheprf */
#qrsvar FQ_FREVNYVMR		0k0400	/* Bayl n fvatyr ybnq onynapvat vafgnapr */
#qrsvar FQ_NFLZ_CNPXVAT		0k0800  /* Cynpr ohfl tebhcf rneyvre va gur qbznva */
#qrsvar FQ_CERSRE_FVOYVAT	0k1000	/* Cersre gb cynpr gnfxf va n fvoyvat qbznva */
#qrsvar FQ_BIREYNC		0k2000	/* fpurq_qbznvaf bs guvf yriry bireync */
#qrsvar FQ_AHZN			0k4000	/* pebff-abqr onynapvat */

#vsqrs PBASVT_FPURQ_FZG
fgngvp vayvar vag pch_fzg_syntf(ibvq)
{
	erghea FQ_FUNER_PCHPNCNPVGL | FQ_FUNER_CXT_ERFBHEPRF;
}
#raqvs

#vsqrs PBASVT_FPURQ_ZP
fgngvp vayvar vag pch_pber_syntf(ibvq)
{
	erghea FQ_FUNER_CXT_ERFBHEPRF;
}
#raqvs

#vsqrs PBASVT_AHZN
fgngvp vayvar vag pch_ahzn_syntf(ibvq)
{
	erghea FQ_AHZN;
}
#raqvs

fgehpg fpurq_qbznva_ngge {
	vag erynk_qbznva_yriry;
};

#qrsvar FQ_NGGE_VAVG	(fgehpg fpurq_qbznva_ngge) {	\
	.erynk_qbznva_yriry = -1,			\
}

rkgrea vag fpurq_qbznva_yriry_znk;

fgehpg fpurq_tebhc;

fgehpg fpurq_qbznva {
	/* Gurfr svryqf zhfg or frghc */
	fgehpg fpurq_qbznva *cnerag;	/* gbc qbznva zhfg or ahyy grezvangrq */
	fgehpg fpurq_qbznva *puvyq;	/* obggbz qbznva zhfg or ahyy grezvangrq */
	fgehpg fpurq_tebhc *tebhcf;	/* gur onynapvat tebhcf bs gur qbznva */
	hafvtarq ybat zva_vagreiny;	/* Zvavzhz onynapr vagreiny zf */
	hafvtarq ybat znk_vagreiny;	/* Znkvzhz onynapr vagreiny zf */
	hafvtarq vag ohfl_snpgbe;	/* yrff onynapvat ol snpgbe vs ohfl */
	hafvtarq vag vzonynapr_cpg;	/* Ab onynapr hagvy bire jngreznex */
	hafvtarq vag pnpur_avpr_gevrf;	/* Yrnir pnpur ubg gnfxf sbe # gevrf */
	hafvtarq vag ohfl_vqk;
	hafvtarq vag vqyr_vqk;
	hafvtarq vag arjvqyr_vqk;
	hafvtarq vag jnxr_vqk;
	hafvtarq vag sbexrkrp_vqk;
	hafvtarq vag fzg_tnva;

	vag abum_vqyr;			/* ABUM VQYR fgnghf */
	vag syntf;			/* Frr FQ_* */
	vag yriry;

	/* Ehagvzr svryqf. */
	hafvtarq ybat ynfg_onynapr;	/* vavg gb wvssvrf. havgf va wvssvrf */
	hafvtarq vag onynapr_vagreiny;	/* vavgvnyvfr gb 1. havgf va zf. */
	hafvtarq vag ae_onynapr_snvyrq; /* vavgvnyvfr gb 0 */

	/* vqyr_onynapr() fgngf */
	h64 znk_arjvqyr_yo_pbfg;
	hafvtarq ybat arkg_qrpnl_znk_yo_pbfg;

#vsqrs PBASVT_FPURQFGNGF
	/* ybnq_onynapr() fgngf */
	hafvtarq vag yo_pbhag[PCH_ZNK_VQYR_GLCRF];
	hafvtarq vag yo_snvyrq[PCH_ZNK_VQYR_GLCRF];
	hafvtarq vag yo_onynaprq[PCH_ZNK_VQYR_GLCRF];
	hafvtarq vag yo_vzonynapr[PCH_ZNK_VQYR_GLCRF];
	hafvtarq vag yo_tnvarq[PCH_ZNK_VQYR_GLCRF];
	hafvtarq vag yo_ubg_tnvarq[PCH_ZNK_VQYR_GLCRF];
	hafvtarq vag yo_abohflt[PCH_ZNK_VQYR_GLCRF];
	hafvtarq vag yo_abohfld[PCH_ZNK_VQYR_GLCRF];

	/* Npgvir ybnq onynapvat */
	hafvtarq vag nyo_pbhag;
	hafvtarq vag nyo_snvyrq;
	hafvtarq vag nyo_chfurq;

	/* FQ_ONYNAPR_RKRP fgngf */
	hafvtarq vag for_pbhag;
	hafvtarq vag for_onynaprq;
	hafvtarq vag for_chfurq;

	/* FQ_ONYNAPR_SBEX fgngf */
	hafvtarq vag fos_pbhag;
	hafvtarq vag fos_onynaprq;
	hafvtarq vag fos_chfurq;

	/* gel_gb_jnxr_hc() fgngf */
	hafvtarq vag ggjh_jnxr_erzbgr;
	hafvtarq vag ggjh_zbir_nssvar;
	hafvtarq vag ggjh_zbir_onynapr;
#raqvs
#vsqrs PBASVT_FPURQ_QROHT
	pune *anzr;
#raqvs
	havba {
		ibvq *cevingr;		/* hfrq qhevat pbafgehpgvba */
		fgehpg eph_urnq eph;	/* hfrq qhevat qrfgehpgvba */
	};

	hafvtarq vag fcna_jrvtug;
	/*
	 * Fcna bs nyy PCHf va guvf qbznva.
	 *
	 * ABGR: guvf svryq vf inevnoyr yratgu. (Nyybpngrq qlanzvpnyyl
	 * ol nggnpuvat rkgen fcnpr gb gur raq bs gur fgehpgher,
	 * qrcraqvat ba ubj znal PCHf gur xreary unf obbgrq hc jvgu)
	 */
	hafvtarq ybat fcna[0];
};

fgngvp vayvar fgehpg pchznfx *fpurq_qbznva_fcna(fgehpg fpurq_qbznva *fq)
{
	erghea gb_pchznfx(fq->fcna);
}

rkgrea ibvq cnegvgvba_fpurq_qbznvaf(vag aqbzf_arj, pchznfx_ine_g qbzf_arj[],
				    fgehpg fpurq_qbznva_ngge *qngge_arj);

/* Nyybpngr na neenl bs fpurq qbznvaf, sbe cnegvgvba_fpurq_qbznvaf(). */
pchznfx_ine_g *nyybp_fpurq_qbznvaf(hafvtarq vag aqbzf);
ibvq serr_fpurq_qbznvaf(pchznfx_ine_g qbzf[], hafvtarq vag aqbzf);

obby pchf_funer_pnpur(vag guvf_pch, vag gung_pch);

glcrqrs pbafg fgehpg pchznfx *(*fpurq_qbznva_znfx_s)(vag pch);
glcrqrs vag (*fpurq_qbznva_syntf_s)(ibvq);

#qrsvar FQGY_BIREYNC	0k01

fgehpg fq_qngn {
	fgehpg fpurq_qbznva **__crepch fq;
	fgehpg fpurq_tebhc **__crepch ft;
	fgehpg fpurq_tebhc_pncnpvgl **__crepch ftp;
};

fgehpg fpurq_qbznva_gbcbybtl_yriry {
	fpurq_qbznva_znfx_s znfx;
	fpurq_qbznva_syntf_s fq_syntf;
	vag		    syntf;
	vag		    ahzn_yriry;
	fgehpg fq_qngn      qngn;
#vsqrs PBASVT_FPURQ_QROHT
	pune                *anzr;
#raqvs
};

rkgrea fgehpg fpurq_qbznva_gbcbybtl_yriry *fpurq_qbznva_gbcbybtl;

rkgrea ibvq frg_fpurq_gbcbybtl(fgehpg fpurq_qbznva_gbcbybtl_yriry *gy);

#vsqrs PBASVT_FPURQ_QROHT
# qrsvar FQ_VAVG_ANZR(glcr)		.anzr = #glcr
#ryfr
# qrsvar FQ_VAVG_ANZR(glcr)
#raqvs

#ryfr /* PBASVT_FZC */

fgehpg fpurq_qbznva_ngge;

fgngvp vayvar ibvq
cnegvgvba_fpurq_qbznvaf(vag aqbzf_arj, pchznfx_ine_g qbzf_arj[],
			fgehpg fpurq_qbznva_ngge *qngge_arj)
{
}

fgngvp vayvar obby pchf_funer_pnpur(vag guvf_pch, vag gung_pch)
{
	erghea gehr;
}

#raqvs	/* !PBASVT_FZC */


fgehpg vb_pbagrkg;			/* Frr oyxqri.u */


#vsqrs NEPU_UNF_CERSRGPU_FJVGPU_FGNPX
rkgrea ibvq cersrgpu_fgnpx(fgehpg gnfx_fgehpg *g);
#ryfr
fgngvp vayvar ibvq cersrgpu_fgnpx(fgehpg gnfx_fgehpg *g) { }
#raqvs

fgehpg nhqvg_pbagrkg;		/* Frr nhqvg.p */
fgehpg zrzcbyvpl;
fgehpg cvcr_vabqr_vasb;
fgehpg hgf_anzrfcnpr;

fgehpg ybnq_jrvtug {
	hafvtarq ybat jrvtug;
	h32 vai_jrvtug;
};

fgehpg fpurq_nit {
	/*
	 * Gurfr fhzf ercerfrag na vasvavgr trbzrgevp frevrf naq fb ner obhaq
	 * nobir ol 1024/(1-l).  Guhf jr bayl arrq n h32 gb fgber gurz sbe nyy
	 * pubvprf bs l < 1-2^(-32)*1024.
	 */
	h32 ehaanoyr_nit_fhz, ehaanoyr_nit_crevbq;
	h64 ynfg_ehaanoyr_hcqngr;
	f64 qrpnl_pbhag;
	hafvtarq ybat ybnq_nit_pbagevo;
};

#vsqrs PBASVT_FPURQFGNGF
fgehpg fpurq_fgngvfgvpf {
	h64			jnvg_fgneg;
	h64			jnvg_znk;
	h64			jnvg_pbhag;
	h64			jnvg_fhz;
	h64			vbjnvg_pbhag;
	h64			vbjnvg_fhz;

	h64			fyrrc_fgneg;
	h64			fyrrc_znk;
	f64			fhz_fyrrc_ehagvzr;

	h64			oybpx_fgneg;
	h64			oybpx_znk;
	h64			rkrp_znk;
	h64			fyvpr_znk;

	h64			ae_zvtengvbaf_pbyq;
	h64			ae_snvyrq_zvtengvbaf_nssvar;
	h64			ae_snvyrq_zvtengvbaf_ehaavat;
	h64			ae_snvyrq_zvtengvbaf_ubg;
	h64			ae_sbeprq_zvtengvbaf;

	h64			ae_jnxrhcf;
	h64			ae_jnxrhcf_flap;
	h64			ae_jnxrhcf_zvtengr;
	h64			ae_jnxrhcf_ybpny;
	h64			ae_jnxrhcf_erzbgr;
	h64			ae_jnxrhcf_nssvar;
	h64			ae_jnxrhcf_nssvar_nggrzcgf;
	h64			ae_jnxrhcf_cnffvir;
	h64			ae_jnxrhcf_vqyr;
};
#raqvs

fgehpg fpurq_ragvgl {
	fgehpg ybnq_jrvtug	ybnq;		/* sbe ybnq-onynapvat */
	fgehpg eo_abqr		eha_abqr;
	fgehpg yvfg_urnq	tebhc_abqr;
	hafvtarq vag		ba_ed;

	h64			rkrp_fgneg;
	h64			fhz_rkrp_ehagvzr;
	h64			iehagvzr;
	h64			ceri_fhz_rkrp_ehagvzr;

	h64			ae_zvtengvbaf;

#vsqrs PBASVT_FPURQFGNGF
	fgehpg fpurq_fgngvfgvpf fgngvfgvpf;
#raqvs

#vsqrs PBASVT_SNVE_TEBHC_FPURQ
	vag			qrcgu;
	fgehpg fpurq_ragvgl	*cnerag;
	/* ed ba juvpu guvf ragvgl vf (gb or) dhrhrq: */
	fgehpg psf_ed		*psf_ed;
	/* ed "bjarq" ol guvf ragvgl/tebhc: */
	fgehpg psf_ed		*zl_d;
#raqvs

#vsqrs PBASVT_FZC
	/* Cre-ragvgl ybnq-genpxvat */
	fgehpg fpurq_nit	nit;
#raqvs
};

fgehpg fpurq_eg_ragvgl {
	fgehpg yvfg_urnq eha_yvfg;
	hafvtarq ybat gvzrbhg;
	hafvtarq ybat jngpuqbt_fgnzc;
	hafvtarq vag gvzr_fyvpr;

	fgehpg fpurq_eg_ragvgl *onpx;
#vsqrs PBASVT_EG_TEBHC_FPURQ
	fgehpg fpurq_eg_ragvgl	*cnerag;
	/* ed ba juvpu guvf ragvgl vf (gb or) dhrhrq: */
	fgehpg eg_ed		*eg_ed;
	/* ed "bjarq" ol guvf ragvgl/tebhc: */
	fgehpg eg_ed		*zl_d;
#raqvs
};

fgehpg fpurq_qy_ragvgl {
	fgehpg eo_abqr	eo_abqr;

	/*
	 * Bevtvany fpurqhyvat cnenzrgref. Pbcvrq urer sebz fpurq_ngge
	 * qhevat fpurq_frgngge(), gurl jvyy erznva gur fnzr hagvy
	 * gur arkg fpurq_frgngge().
	 */
	h64 qy_ehagvzr;		/* znkvzhz ehagvzr sbe rnpu vafgnapr	*/
	h64 qy_qrnqyvar;	/* eryngvir qrnqyvar bs rnpu vafgnapr	*/
	h64 qy_crevbq;		/* frcnengvba bs gjb vafgnaprf (crevbq) */
	h64 qy_oj;		/* qy_ehagvzr / qy_qrnqyvar		*/

	/*
	 * Npghny fpurqhyvat cnenzrgref. Vavgvnyvmrq jvgu gur inyhrf nobir,
	 * gurl ner pbagvabhfyl hcqngrq qhevat gnfx rkrphgvba. Abgr gung
	 * gur erznvavat ehagvzr pbhyq or < 0 va pnfr jr ner va bireeha.
	 */
	f64 ehagvzr;		/* erznvavat ehagvzr sbe guvf vafgnapr	*/
	h64 qrnqyvar;		/* nofbyhgr qrnqyvar sbe guvf vafgnapr	*/
	hafvtarq vag syntf;	/* fcrpvslvat gur fpurqhyre orunivbhe	*/

	/*
	 * Fbzr obby syntf:
	 *
	 * @qy_guebggyrq gryyf vs jr rkunhfgrq gur ehagvzr. Vs fb, gur
	 * gnfx unf gb jnvg sbe n ercyravfuzrag gb or cresbezrq ng gur
	 * arkg svevat bs qy_gvzre.
	 *
	 * @qy_arj gryyf vs n arj vafgnapr neevirq. Vs fb jr zhfg
	 * fgneg rkrphgvat vg jvgu shyy ehagvzr naq erfrg vgf nofbyhgr
	 * qrnqyvar;
	 *
	 * @qy_obbfgrq gryyf vs jr ner obbfgrq qhr gb QV. Vs fb jr ner
	 * bhgfvqr onaqjvqgu rasbeprzrag zrpunavfz (ohg bayl hagvy jr
	 * rkvg gur pevgvpny frpgvba);
	 *
	 * @qy_lvryqrq gryyf vs gnfx tnir hc gur pch orsber pbafhzvat
	 * nyy vgf ninvynoyr ehagvzr qhevat gur ynfg wbo.
	 */
	vag qy_guebggyrq, qy_arj, qy_obbfgrq, qy_lvryqrq;

	/*
	 * Onaqjvqgu rasbeprzrag gvzre. Rnpu -qrnqyvar gnfx unf vgf
	 * bja onaqjvqgu gb or rasbeprq, guhf jr arrq bar gvzre cre gnfx.
	 */
	fgehpg uegvzre qy_gvzre;
};

fgehpg eph_abqr;

rahz cres_rirag_gnfx_pbagrkg {
	cres_vainyvq_pbagrkg = -1,
	cres_uj_pbagrkg = 0,
	cres_fj_pbagrkg,
	cres_ae_gnfx_pbagrkgf,
};

fgehpg gnfx_fgehpg {
	ibyngvyr ybat fgngr;	/* -1 haehaanoyr, 0 ehaanoyr, >0 fgbccrq */
	ibvq *fgnpx;
	ngbzvp_g hfntr;
	hafvtarq vag syntf;	/* cre cebprff syntf, qrsvarq orybj */
	hafvtarq vag cgenpr;

#vsqrs PBASVT_FZC
	fgehpg yyvfg_abqr jnxr_ragel;
	vag ba_pch;
	fgehpg gnfx_fgehpg *ynfg_jnxrr;
	hafvtarq ybat jnxrr_syvcf;
	hafvtarq ybat jnxrr_syvc_qrpnl_gf;

	vag jnxr_pch;
#raqvs
	vag ba_ed;

	vag cevb, fgngvp_cevb, abezny_cevb;
	hafvtarq vag eg_cevbevgl;
	pbafg fgehpg fpurq_pynff *fpurq_pynff;
	fgehpg fpurq_ragvgl fr;
	fgehpg fpurq_eg_ragvgl eg;
#vsqrs PBASVT_PTEBHC_FPURQ
	fgehpg gnfx_tebhc *fpurq_gnfx_tebhc;
#raqvs
	fgehpg fpurq_qy_ragvgl qy;

#vsqrs PBASVT_CERRZCG_ABGVSVREF
	/* yvfg bs fgehpg cerrzcg_abgvsvre: */
	fgehpg uyvfg_urnq cerrzcg_abgvsvref;
#raqvs

#vsqrs PBASVT_OYX_QRI_VB_GENPR
	hafvtarq vag ogenpr_frd;
#raqvs

	hafvtarq vag cbyvpl;
	vag ae_pchf_nyybjrq;
	pchznfx_g pchf_nyybjrq;

#vsqrs PBASVT_CERRZCG_EPH
	vag eph_ernq_ybpx_arfgvat;
	pune eph_ernq_haybpx_fcrpvny;
	fgehpg yvfg_urnq eph_abqr_ragel;
#raqvs /* #vsqrs PBASVT_CERRZCG_EPH */
#vsqrs PBASVT_GERR_CERRZCG_EPH
	fgehpg eph_abqr *eph_oybpxrq_abqr;
#raqvs /* #vsqrs PBASVT_GERR_CERRZCG_EPH */
#vsqrs PBASVT_EPH_OBBFG
	fgehpg eg_zhgrk *eph_obbfg_zhgrk;
#raqvs /* #vsqrs PBASVT_EPH_OBBFG */

#vs qrsvarq(PBASVT_FPURQFGNGF) || qrsvarq(PBASVT_GNFX_QRYNL_NPPG)
	fgehpg fpurq_vasb fpurq_vasb;
#raqvs

	fgehpg yvfg_urnq gnfxf;
#vsqrs PBASVT_FZC
	fgehpg cyvfg_abqr chfunoyr_gnfxf;
	fgehpg eo_abqr chfunoyr_qy_gnfxf;
#raqvs

	fgehpg zz_fgehpg *zz, *npgvir_zz;
#vsqrs PBASVT_PBZCNG_OEX
	hafvtarq oex_enaqbzvmrq:1;
#raqvs
	/* cre-guernq izn pnpuvat */
	h32 iznpnpur_frdahz;
	fgehpg iz_nern_fgehpg *iznpnpur[IZNPNPUR_FVMR];
#vs qrsvarq(FCYVG_EFF_PBHAGVAT)
	fgehpg gnfx_eff_fgng	eff_fgng;
#raqvs
/* gnfx fgngr */
	vag rkvg_fgngr;
	vag rkvg_pbqr, rkvg_fvtany;
	vag cqrngu_fvtany;  /*  Gur fvtany frag jura gur cnerag qvrf  */
	hafvtarq vag wbopgy;	/* WBOPGY_*, fvtybpx cebgrpgrq */

	/* Hfrq sbe rzhyngvat NOV orunivbe bs cerivbhf Yvahk irefvbaf */
	hafvtarq vag crefbanyvgl;

	hafvtarq va_rkrpir:1;	/* Gryy gur YFZf gung gur cebprff vf qbvat na
				 * rkrpir */
	hafvtarq va_vbjnvg:1;

	/* gnfx znl abg tnva cevivyrtrf */
	hafvtarq ab_arj_cevif:1;

	/* Erireg gb qrsnhyg cevbevgl/cbyvpl jura sbexvat */
	hafvtarq fpurq_erfrg_ba_sbex:1;
	hafvtarq fpurq_pbagevohgrf_gb_ybnq:1;

	cvq_g cvq;
	cvq_g gtvq;

#vsqrs PBASVT_PP_FGNPXCEBGRPGBE
	/* Pnanel inyhr sbe gur -sfgnpx-cebgrpgbe tpp srngher */
	hafvtarq ybat fgnpx_pnanel;
#raqvs
	/*
	 * cbvagref gb (bevtvany) cnerag cebprff, lbhatrfg puvyq, lbhatre fvoyvat,
	 * byqre fvoyvat, erfcrpgviryl.  (c->sngure pna or ercynprq jvgu
	 * c->erny_cnerag->cvq)
	 */
	fgehpg gnfx_fgehpg __eph *erny_cnerag; /* erny cnerag cebprff */
	fgehpg gnfx_fgehpg __eph *cnerag; /* erpvcvrag bs FVTPUYQ, jnvg4() ercbegf */
	/*
	 * puvyqera/fvoyvat sbezf gur yvfg bs zl angheny puvyqera
	 */
	fgehpg yvfg_urnq puvyqera;	/* yvfg bs zl puvyqera */
	fgehpg yvfg_urnq fvoyvat;	/* yvaxntr va zl cnerag'f puvyqera yvfg */
	fgehpg gnfx_fgehpg *tebhc_yrnqre;	/* guernqtebhc yrnqre */

	/*
	 * cgenprq vf gur yvfg bs gnfxf guvf gnfx vf hfvat cgenpr ba.
	 * Guvf vapyhqrf obgu angheny puvyqera naq CGENPR_NGGNPU gnetrgf.
	 * c->cgenpr_ragel vf c'f yvax ba gur c->cnerag->cgenprq yvfg.
	 */
	fgehpg yvfg_urnq cgenprq;
	fgehpg yvfg_urnq cgenpr_ragel;

	/* CVQ/CVQ unfu gnoyr yvaxntr. */
	fgehpg cvq_yvax cvqf[CVQGLCR_ZNK];
	fgehpg yvfg_urnq guernq_tebhc;
	fgehpg yvfg_urnq guernq_abqr;

	fgehpg pbzcyrgvba *isbex_qbar;		/* sbe isbex() */
	vag __hfre *frg_puvyq_gvq;		/* PYBAR_PUVYQ_FRGGVQ */
	vag __hfre *pyrne_puvyq_gvq;		/* PYBAR_PUVYQ_PYRNEGVQ */

	pchgvzr_g hgvzr, fgvzr, hgvzrfpnyrq, fgvzrfpnyrq;
	pchgvzr_g tgvzr;
#vsaqrs PBASVT_IVEG_PCH_NPPBHAGVAT_ANGVIR
	fgehpg pchgvzr ceri_pchgvzr;
#raqvs
#vsqrs PBASVT_IVEG_PCH_NPPBHAGVAT_TRA
	frdybpx_g igvzr_frdybpx;
	hafvtarq ybat ybat igvzr_fanc;
	rahz {
		IGVZR_FYRRCVAT = 0,
		IGVZR_HFRE,
		IGVZR_FLF,
	} igvzr_fanc_jurapr;
#raqvs
	hafvtarq ybat aipfj, avipfj; /* pbagrkg fjvgpu pbhagf */
	fgehpg gvzrfcrp fgneg_gvzr; 		/* zbabgbavp gvzr */
	fgehpg gvzrfcrp erny_fgneg_gvzr;	/* obbg onfrq gvzr */
/* zz snhyg naq fjnc vasb: guvf pna nethnoyl or frra nf rvgure zz-fcrpvsvp be guernq-fcrpvsvp */
	hafvtarq ybat zva_syg, znw_syg;

	fgehpg gnfx_pchgvzr pchgvzr_rkcverf;
	fgehpg yvfg_urnq pch_gvzref[3];

/* cebprff perqragvnyf */
	pbafg fgehpg perq __eph *erny_perq; /* bowrpgvir naq erny fhowrpgvir gnfx
					 * perqragvnyf (PBJ) */
	pbafg fgehpg perq __eph *perq;	/* rssrpgvir (bireevqnoyr) fhowrpgvir gnfx
					 * perqragvnyf (PBJ) */
	pune pbzz[GNFX_PBZZ_YRA]; /* rkrphgnoyr anzr rkpyhqvat cngu
				     - npprff jvgu [tf]rg_gnfx_pbzz (juvpu ybpx
				       vg jvgu gnfx_ybpx())
				     - vavgvnyvmrq abeznyyl ol frghc_arj_rkrp */
/* svyr flfgrz vasb */
	vag yvax_pbhag, gbgny_yvax_pbhag;
#vsqrs PBASVT_FLFIVCP
/* vcp fghss */
	fgehpg flfi_frz flfifrz;
#raqvs
#vsqrs PBASVT_QRGRPG_UHAT_GNFX
/* uhat gnfx qrgrpgvba */
	hafvtarq ybat ynfg_fjvgpu_pbhag;
#raqvs
/* PCH-fcrpvsvp fgngr bs guvf gnfx */
	fgehpg guernq_fgehpg guernq;
/* svyrflfgrz vasbezngvba */
	fgehpg sf_fgehpg *sf;
/* bcra svyr vasbezngvba */
	fgehpg svyrf_fgehpg *svyrf;
/* anzrfcnprf */
	fgehpg afcebkl *afcebkl;
/* fvtany unaqyref */
	fgehpg fvtany_fgehpg *fvtany;
	fgehpg fvtunaq_fgehpg *fvtunaq;

	fvtfrg_g oybpxrq, erny_oybpxrq;
	fvtfrg_g fnirq_fvtznfx;	/* erfgberq vs frg_erfgber_fvtznfx() jnf hfrq */
	fgehpg fvtcraqvat craqvat;

	hafvtarq ybat fnf_ff_fc;
	fvmr_g fnf_ff_fvmr;
	vag (*abgvsvre)(ibvq *cevi);
	ibvq *abgvsvre_qngn;
	fvtfrg_g *abgvsvre_znfx;
	fgehpg pnyyonpx_urnq *gnfx_jbexf;

	fgehpg nhqvg_pbagrkg *nhqvg_pbagrkg;
#vsqrs PBASVT_NHQVGFLFPNYY
	xhvq_g ybtvahvq;
	hafvtarq vag frffvbavq;
#raqvs
	fgehpg frppbzc frppbzc;

/* Guernq tebhc genpxvat */
   	h32 cnerag_rkrp_vq;
   	h32 frys_rkrp_vq;
/* Cebgrpgvba bs (qr-)nyybpngvba: zz, svyrf, sf, ggl, xrlevatf, zrzf_nyybjrq,
 * zrzcbyvpl */
	fcvaybpx_g nyybp_ybpx;

	/* Cebgrpgvba bs gur CV qngn fgehpgherf: */
	enj_fcvaybpx_g cv_ybpx;

#vsqrs PBASVT_EG_ZHGRKRF
	/* CV jnvgref oybpxrq ba n eg_zhgrk uryq ol guvf gnfx */
	fgehpg eo_ebbg cv_jnvgref;
	fgehpg eo_abqr *cv_jnvgref_yrsgzbfg;
	/* Qrnqybpx qrgrpgvba naq cevbevgl vaurevgnapr unaqyvat */
	fgehpg eg_zhgrk_jnvgre *cv_oybpxrq_ba;
	/* Gbc cv_jnvgref gnfx */
	fgehpg gnfx_fgehpg *cv_gbc_gnfx;
#raqvs

#vsqrs PBASVT_QROHT_ZHGRKRF
	/* zhgrk qrnqybpx qrgrpgvba */
	fgehpg zhgrk_jnvgre *oybpxrq_ba;
#raqvs
#vsqrs PBASVT_GENPR_VEDSYNTF
	hafvtarq vag ved_riragf;
	hafvtarq ybat uneqved_ranoyr_vc;
	hafvtarq ybat uneqved_qvfnoyr_vc;
	hafvtarq vag uneqved_ranoyr_rirag;
	hafvtarq vag uneqved_qvfnoyr_rirag;
	vag uneqvedf_ranoyrq;
	vag uneqved_pbagrkg;
	hafvtarq ybat fbsgved_qvfnoyr_vc;
	hafvtarq ybat fbsgved_ranoyr_vc;
	hafvtarq vag fbsgved_qvfnoyr_rirag;
	hafvtarq vag fbsgved_ranoyr_rirag;
	vag fbsgvedf_ranoyrq;
	vag fbsgved_pbagrkg;
#raqvs
#vsqrs PBASVT_YBPXQRC
# qrsvar ZNK_YBPX_QRCGU 48HY
	h64 phee_punva_xrl;
	vag ybpxqrc_qrcgu;
	hafvtarq vag ybpxqrc_erphefvba;
	fgehpg uryq_ybpx uryq_ybpxf[ZNK_YBPX_QRCGU];
	tsc_g ybpxqrc_erpynvz_tsc;
#raqvs

/* wbheanyyvat svyrflfgrz vasb */
	ibvq *wbheany_vasb;

/* fgnpxrq oybpx qrivpr vasb */
	fgehpg ovb_yvfg *ovb_yvfg;

#vsqrs PBASVT_OYBPX
/* fgnpx cyhttvat */
	fgehpg oyx_cyht *cyht;
#raqvs

/* IZ fgngr */
	fgehpg erpynvz_fgngr *erpynvz_fgngr;

	fgehpg onpxvat_qri_vasb *onpxvat_qri_vasb;

	fgehpg vb_pbagrkg *vb_pbagrkg;

	hafvtarq ybat cgenpr_zrffntr;
	fvtvasb_g *ynfg_fvtvasb; /* Sbe cgenpr hfr.  */
	fgehpg gnfx_vb_nppbhagvat vbnp;
#vs qrsvarq(PBASVT_GNFX_KNPPG)
	h64 nppg_eff_zrz1;	/* npphzhyngrq eff hfntr */
	h64 nppg_iz_zrz1;	/* npphzhyngrq iveghny zrzbel hfntr */
	pchgvzr_g nppg_gvzrkcq;	/* fgvzr + hgvzr fvapr ynfg hcqngr */
#raqvs
#vsqrs PBASVT_PCHFRGF
	abqrznfx_g zrzf_nyybjrq;	/* Cebgrpgrq ol nyybp_ybpx */
	frdpbhag_g zrzf_nyybjrq_frd;	/* Frdrapr ab gb pngpu hcqngrf */
	vag pchfrg_zrz_fcernq_ebgbe;
	vag pchfrg_fyno_fcernq_ebgbe;
#raqvs
#vsqrs PBASVT_PTEBHCF
	/* Pbageby Tebhc vasb cebgrpgrq ol pff_frg_ybpx */
	fgehpg pff_frg __eph *ptebhcf;
	/* pt_yvfg cebgrpgrq ol pff_frg_ybpx naq gfx->nyybp_ybpx */
	fgehpg yvfg_urnq pt_yvfg;
#raqvs
#vsqrs PBASVT_SHGRK
	fgehpg ebohfg_yvfg_urnq __hfre *ebohfg_yvfg;
#vsqrs PBASVT_PBZCNG
	fgehpg pbzcng_ebohfg_yvfg_urnq __hfre *pbzcng_ebohfg_yvfg;
#raqvs
	fgehpg yvfg_urnq cv_fgngr_yvfg;
	fgehpg shgrk_cv_fgngr *cv_fgngr_pnpur;
#raqvs
#vsqrs PBASVT_CRES_RIRAGF
	fgehpg cres_rirag_pbagrkg *cres_rirag_pgkc[cres_ae_gnfx_pbagrkgf];
	fgehpg zhgrk cres_rirag_zhgrk;
	fgehpg yvfg_urnq cres_rirag_yvfg;
#raqvs
#vsqrs PBASVT_QROHT_CERRZCG
	hafvtarq ybat cerrzcg_qvfnoyr_vc;
#raqvs
#vsqrs PBASVT_AHZN
	fgehpg zrzcbyvpl *zrzcbyvpl;	/* Cebgrpgrq ol nyybp_ybpx */
	fubeg vy_arkg;
	fubeg cers_abqr_sbex;
#raqvs
#vsqrs PBASVT_AHZN_ONYNAPVAT
	vag ahzn_fpna_frd;
	hafvtarq vag ahzn_fpna_crevbq;
	hafvtarq vag ahzn_fpna_crevbq_znk;
	vag ahzn_cersreerq_avq;
	hafvtarq ybat ahzn_zvtengr_ergel;
	h64 abqr_fgnzc;			/* zvtengvba fgnzc  */
	h64 ynfg_gnfx_ahzn_cynprzrag;
	h64 ynfg_fhz_rkrp_ehagvzr;
	fgehpg pnyyonpx_urnq ahzn_jbex;

	fgehpg yvfg_urnq ahzn_ragel;
	fgehpg ahzn_tebhc *ahzn_tebhc;

	/*
	 * Rkcbaragvny qrpnlvat nirentr bs snhygf ba n cre-abqr onfvf.
	 * Fpurqhyvat cynprzrag qrpvfvbaf ner znqr onfrq ba gur gurfr pbhagf.
	 * Gur inyhrf erznva fgngvp sbe gur qhengvba bs n CGR fpna
	 */
	hafvtarq ybat *ahzn_snhygf_zrzbel;
	hafvtarq ybat gbgny_ahzn_snhygf;

	/*
	 * ahzn_snhygf_ohssre erpbeqf snhygf cre abqr qhevat gur pheerag
	 * fpna jvaqbj. Jura gur fpna pbzcyrgrf, gur pbhagf va
	 * ahzn_snhygf_zrzbel qrpnl naq gurfr inyhrf ner pbcvrq.
	 */
	hafvtarq ybat *ahzn_snhygf_ohssre_zrzbel;

	/*
	 * Genpx gur abqrf gur cebprff jnf ehaavat ba jura n AHZN uvagvat
	 * snhyg jnf vapheerq.
	 */
	hafvtarq ybat *ahzn_snhygf_pch;
	hafvtarq ybat *ahzn_snhygf_ohssre_pch;

	/*
	 * ahzn_snhygf_ybpnyvgl genpxf vs snhygf erpbeqrq qhevat gur ynfg
	 * fpna jvaqbj jrer erzbgr/ybpny. Gur gnfx fpna crevbq vf nqncgrq
	 * onfrq ba gur ybpnyvgl bs gur snhygf jvgu qvssrerag jrvtugf
	 * qrcraqvat ba jurgure gurl jrer funerq be cevingr snhygf
	 */
	hafvtarq ybat ahzn_snhygf_ybpnyvgl[2];

	hafvtarq ybat ahzn_cntrf_zvtengrq;
#raqvs /* PBASVT_AHZN_ONYNAPVAT */

	fgehpg eph_urnq eph;

	/*
	 * pnpur ynfg hfrq cvcr sbe fcyvpr
	 */
	fgehpg cvcr_vabqr_vasb *fcyvpr_cvcr;

	fgehpg cntr_sent gnfx_sent;

#vsqrs	PBASVT_GNFX_QRYNL_NPPG
	fgehpg gnfx_qrynl_vasb *qrynlf;
#raqvs
#vsqrs PBASVT_SNHYG_VAWRPGVBA
	vag znxr_vg_snvy;
#raqvs
	/*
	 * jura (ae_qvegvrq >= ae_qvegvrq_cnhfr), vg'f gvzr gb pnyy
	 * onynapr_qvegl_cntrf() sbe fbzr qvegl guebggyvat cnhfr
	 */
	vag ae_qvegvrq;
	vag ae_qvegvrq_cnhfr;
	hafvtarq ybat qvegl_cnhfrq_jura; /* fgneg bs n jevgr-naq-cnhfr crevbq */

#vsqrs PBASVT_YNGRAPLGBC
	vag yngrapl_erpbeq_pbhag;
	fgehpg yngrapl_erpbeq yngrapl_erpbeq[YG_FNIRPBHAG];
#raqvs
	/*
	 * gvzr fynpx inyhrf; gurfr ner hfrq gb ebhaq hc cbyy() naq
	 * fryrpg() rgp gvzrbhg inyhrf. Gurfr ner va anabfrpbaqf.
	 */
	hafvtarq ybat gvzre_fynpx_af;
	hafvtarq ybat qrsnhyg_gvzre_fynpx_af;

#vsqrs PBASVT_SHAPGVBA_TENCU_GENPRE
	/* Vaqrk bs pheerag fgberq nqqerff va erg_fgnpx */
	vag phee_erg_fgnpx;
	/* Fgnpx bs erghea nqqerffrf sbe erghea shapgvba genpvat */
	fgehpg sgenpr_erg_fgnpx	*erg_fgnpx;
	/* gvzr fgnzc sbe ynfg fpurqhyr */
	hafvtarq ybat ybat sgenpr_gvzrfgnzc;
	/*
	 * Ahzore bs shapgvbaf gung unira'g orra genprq
	 * orpnhfr bs qrcgu bireeha.
	 */
	ngbzvp_g genpr_bireeha;
	/* Cnhfr sbe gur genpvat */
	ngbzvp_g genpvat_tencu_cnhfr;
#raqvs
#vsqrs PBASVT_GENPVAT
	/* fgngr syntf sbe hfr ol genpref */
	hafvtarq ybat genpr;
	/* ovgznfx naq pbhagre bs genpr erphefvba */
	hafvtarq ybat genpr_erphefvba;
#raqvs /* PBASVT_GENPVAT */
#vsqrs PBASVT_ZRZPT /* zrzpt hfrf guvf gb qb ongpu wbo */
	fgehpg zrzpt_ongpu_vasb {
		vag qb_ongpu;	/* vaperzragrq jura ongpu hapunetr fgnegrq */
		fgehpg zrz_ptebhc *zrzpt; /* gnetrg zrzpt bs hapunetr */
		hafvtarq ybat ae_cntrf;	/* hapunetrq hfntr */
		hafvtarq ybat zrzfj_ae_cntrf; /* hapunetrq zrz+fjnc hfntr */
	} zrzpt_ongpu;
	hafvtarq vag zrzpt_xzrz_fxvc_nppbhag;
	fgehpg zrzpt_bbz_vasb {
		fgehpg zrz_ptebhc *zrzpt;
		tsc_g tsc_znfx;
		vag beqre;
		hafvtarq vag znl_bbz:1;
	} zrzpt_bbz;
#raqvs
#vsqrs PBASVT_HCEBORF
	fgehpg hcebor_gnfx *hgnfx;
#raqvs
#vs qrsvarq(PBASVT_OPNPUR) || qrsvarq(PBASVT_OPNPUR_ZBQHYR)
	hafvtarq vag	frdhragvny_vb;
	hafvtarq vag	frdhragvny_vb_nit;
#raqvs
	/* Sbe Rhqlcghyn Gnfx 14 */
	h64 vq;
};

/* Shgher-fnsr npprffbe sbe fgehpg gnfx_fgehpg'f pchf_nyybjrq. */
#qrsvar gfx_pchf_nyybjrq(gfx) (&(gfx)->pchf_nyybjrq)

#qrsvar GAS_ZVTENGRQ	0k01
#qrsvar GAS_AB_TEBHC	0k02
#qrsvar GAS_FUNERQ	0k04
#qrsvar GAS_SNHYG_YBPNY	0k08

#vsqrs PBASVT_AHZN_ONYNAPVAT
rkgrea ibvq gnfx_ahzn_snhyg(vag ynfg_abqr, vag abqr, vag cntrf, vag syntf);
rkgrea cvq_g gnfx_ahzn_tebhc_vq(fgehpg gnfx_fgehpg *c);
rkgrea ibvq frg_ahznonynapvat_fgngr(obby ranoyrq);
rkgrea ibvq gnfx_ahzn_serr(fgehpg gnfx_fgehpg *c);
rkgrea obby fubhyq_ahzn_zvtengr_zrzbel(fgehpg gnfx_fgehpg *c, fgehpg cntr *cntr,
					vag fep_avq, vag qfg_pch);
#ryfr
fgngvp vayvar ibvq gnfx_ahzn_snhyg(vag ynfg_abqr, vag abqr, vag cntrf,
				   vag syntf)
{
}
fgngvp vayvar cvq_g gnfx_ahzn_tebhc_vq(fgehpg gnfx_fgehpg *c)
{
	erghea 0;
}
fgngvp vayvar ibvq frg_ahznonynapvat_fgngr(obby ranoyrq)
{
}
fgngvp vayvar ibvq gnfx_ahzn_serr(fgehpg gnfx_fgehpg *c)
{
}
fgngvp vayvar obby fubhyq_ahzn_zvtengr_zrzbel(fgehpg gnfx_fgehpg *c,
				fgehpg cntr *cntr, vag fep_avq, vag qfg_pch)
{
	erghea gehr;
}
#raqvs

fgngvp vayvar fgehpg cvq *gnfx_cvq(fgehpg gnfx_fgehpg *gnfx)
{
	erghea gnfx->cvqf[CVQGLCR_CVQ].cvq;
}

fgngvp vayvar fgehpg cvq *gnfx_gtvq(fgehpg gnfx_fgehpg *gnfx)
{
	erghea gnfx->tebhc_yrnqre->cvqf[CVQGLCR_CVQ].cvq;
}

/*
 * Jvgubhg gnfxyvfg be eph ybpx vg vf abg fnsr gb qrersrerapr
 * gur erfhyg bs gnfx_ctec/gnfx_frffvba rira vs gnfx == pheerag,
 * jr pna enpr jvgu nabgure guernq qbvat flf_frgfvq/flf_frgctvq.
 */
fgngvp vayvar fgehpg cvq *gnfx_ctec(fgehpg gnfx_fgehpg *gnfx)
{
	erghea gnfx->tebhc_yrnqre->cvqf[CVQGLCR_CTVQ].cvq;
}

fgngvp vayvar fgehpg cvq *gnfx_frffvba(fgehpg gnfx_fgehpg *gnfx)
{
	erghea gnfx->tebhc_yrnqre->cvqf[CVQGLCR_FVQ].cvq;
}

fgehpg cvq_anzrfcnpr;

/*
 * gur urycref gb trg gur gnfx'f qvssrerag cvqf nf gurl ner frra
 * sebz inevbhf anzrfcnprf
 *
 * gnfx_kvq_ae()     : tybony vq, v.r. gur vq frra sebz gur vavg anzrfcnpr;
 * gnfx_kvq_iae()    : iveghny vq, v.r. gur vq frra sebz gur cvq anzrfcnpr bs
 *                     pheerag.
 * gnfx_kvq_ae_af()  : vq frra sebz gur af fcrpvsvrq;
 *
 * frg_gnfx_ikvq()   : nffvtaf n iveghny vq gb n gnfx;
 *
 * frr nyfb cvq_ae() rgp va vapyhqr/yvahk/cvq.u
 */
cvq_g __gnfx_cvq_ae_af(fgehpg gnfx_fgehpg *gnfx, rahz cvq_glcr glcr,
			fgehpg cvq_anzrfcnpr *af);

fgngvp vayvar cvq_g gnfx_cvq_ae(fgehpg gnfx_fgehpg *gfx)
{
	erghea gfx->cvq;
}

fgngvp vayvar cvq_g gnfx_cvq_ae_af(fgehpg gnfx_fgehpg *gfx,
					fgehpg cvq_anzrfcnpr *af)
{
	erghea __gnfx_cvq_ae_af(gfx, CVQGLCR_CVQ, af);
}

fgngvp vayvar cvq_g gnfx_cvq_iae(fgehpg gnfx_fgehpg *gfx)
{
	erghea __gnfx_cvq_ae_af(gfx, CVQGLCR_CVQ, AHYY);
}


fgngvp vayvar cvq_g gnfx_gtvq_ae(fgehpg gnfx_fgehpg *gfx)
{
	erghea gfx->gtvq;
}

cvq_g gnfx_gtvq_ae_af(fgehpg gnfx_fgehpg *gfx, fgehpg cvq_anzrfcnpr *af);

fgngvp vayvar cvq_g gnfx_gtvq_iae(fgehpg gnfx_fgehpg *gfx)
{
	erghea cvq_iae(gnfx_gtvq(gfx));
}


fgngvp vayvar vag cvq_nyvir(pbafg fgehpg gnfx_fgehpg *c);
fgngvp vayvar cvq_g gnfx_ccvq_ae_af(pbafg fgehpg gnfx_fgehpg *gfx, fgehpg cvq_anzrfcnpr *af)
{
	cvq_g cvq = 0;

	eph_ernq_ybpx();
	vs (cvq_nyvir(gfx))
		cvq = gnfx_gtvq_ae_af(eph_qrersrerapr(gfx->erny_cnerag), af);
	eph_ernq_haybpx();

	erghea cvq;
}

fgngvp vayvar cvq_g gnfx_ccvq_ae(pbafg fgehpg gnfx_fgehpg *gfx)
{
	erghea gnfx_ccvq_ae_af(gfx, &vavg_cvq_af);
}

fgngvp vayvar cvq_g gnfx_ctec_ae_af(fgehpg gnfx_fgehpg *gfx,
					fgehpg cvq_anzrfcnpr *af)
{
	erghea __gnfx_cvq_ae_af(gfx, CVQGLCR_CTVQ, af);
}

fgngvp vayvar cvq_g gnfx_ctec_iae(fgehpg gnfx_fgehpg *gfx)
{
	erghea __gnfx_cvq_ae_af(gfx, CVQGLCR_CTVQ, AHYY);
}


fgngvp vayvar cvq_g gnfx_frffvba_ae_af(fgehpg gnfx_fgehpg *gfx,
					fgehpg cvq_anzrfcnpr *af)
{
	erghea __gnfx_cvq_ae_af(gfx, CVQGLCR_FVQ, af);
}

fgngvp vayvar cvq_g gnfx_frffvba_iae(fgehpg gnfx_fgehpg *gfx)
{
	erghea __gnfx_cvq_ae_af(gfx, CVQGLCR_FVQ, AHYY);
}

/* bofbyrgr, qb abg hfr */
fgngvp vayvar cvq_g gnfx_ctec_ae(fgehpg gnfx_fgehpg *gfx)
{
	erghea gnfx_ctec_ae_af(gfx, &vavg_cvq_af);
}

/**
 * cvq_nyvir - purpx gung n gnfx fgehpgher vf abg fgnyr
 * @c: Gnfx fgehpgher gb or purpxrq.
 *
 * Grfg vs n cebprff vf abg lrg qrnq (ng zbfg mbzovr fgngr)
 * Vs cvq_nyvir snvyf, gura cbvagref jvguva gur gnfx fgehpgher
 * pna or fgnyr naq zhfg abg or qrersreraprq.
 *
 * Erghea: 1 vs gur cebprff vf nyvir. 0 bgurejvfr.
 */
fgngvp vayvar vag cvq_nyvir(pbafg fgehpg gnfx_fgehpg *c)
{
	erghea c->cvqf[CVQGLCR_CVQ].cvq != AHYY;
}

/**
 * vf_tybony_vavg - purpx vs n gnfx fgehpgher vf vavg
 * @gfx: Gnfx fgehpgher gb or purpxrq.
 *
 * Purpx vs n gnfx fgehpgher vf gur svefg hfre fcnpr gnfx gur xreary perngrq.
 *
 * Erghea: 1 vs gur gnfx fgehpgher vf vavg. 0 bgurejvfr.
 */
fgngvp vayvar vag vf_tybony_vavg(fgehpg gnfx_fgehpg *gfx)
{
	erghea gfx->cvq == 1;
}

rkgrea fgehpg cvq *pnq_cvq;

rkgrea ibvq serr_gnfx(fgehpg gnfx_fgehpg *gfx);
#qrsvar trg_gnfx_fgehpg(gfx) qb { ngbzvp_vap(&(gfx)->hfntr); } juvyr(0)

rkgrea ibvq __chg_gnfx_fgehpg(fgehpg gnfx_fgehpg *g);

fgngvp vayvar ibvq chg_gnfx_fgehpg(fgehpg gnfx_fgehpg *g)
{
	vs (ngbzvp_qrp_naq_grfg(&g->hfntr))
		__chg_gnfx_fgehpg(g);
}

#vsqrs PBASVT_IVEG_PCH_NPPBHAGVAT_TRA
rkgrea ibvq gnfx_pchgvzr(fgehpg gnfx_fgehpg *g,
			 pchgvzr_g *hgvzr, pchgvzr_g *fgvzr);
rkgrea ibvq gnfx_pchgvzr_fpnyrq(fgehpg gnfx_fgehpg *g,
				pchgvzr_g *hgvzrfpnyrq, pchgvzr_g *fgvzrfpnyrq);
rkgrea pchgvzr_g gnfx_tgvzr(fgehpg gnfx_fgehpg *g);
#ryfr
fgngvp vayvar ibvq gnfx_pchgvzr(fgehpg gnfx_fgehpg *g,
				pchgvzr_g *hgvzr, pchgvzr_g *fgvzr)
{
	vs (hgvzr)
		*hgvzr = g->hgvzr;
	vs (fgvzr)
		*fgvzr = g->fgvzr;
}

fgngvp vayvar ibvq gnfx_pchgvzr_fpnyrq(fgehpg gnfx_fgehpg *g,
				       pchgvzr_g *hgvzrfpnyrq,
				       pchgvzr_g *fgvzrfpnyrq)
{
	vs (hgvzrfpnyrq)
		*hgvzrfpnyrq = g->hgvzrfpnyrq;
	vs (fgvzrfpnyrq)
		*fgvzrfpnyrq = g->fgvzrfpnyrq;
}

fgngvp vayvar pchgvzr_g gnfx_tgvzr(fgehpg gnfx_fgehpg *g)
{
	erghea g->tgvzr;
}
#raqvs
rkgrea ibvq gnfx_pchgvzr_nqwhfgrq(fgehpg gnfx_fgehpg *c, pchgvzr_g *hg, pchgvzr_g *fg);
rkgrea ibvq guernq_tebhc_pchgvzr_nqwhfgrq(fgehpg gnfx_fgehpg *c, pchgvzr_g *hg, pchgvzr_g *fg);

/*
 * Cre cebprff syntf
 */
#qrsvar CS_RKVGVAT	0k00000004	/* trggvat fuhg qbja */
#qrsvar CS_RKVGCVQBAR	0k00000008	/* cv rkvg qbar ba fuhg qbja */
#qrsvar CS_IPCH		0k00000010	/* V'z n iveghny PCH */
#qrsvar CS_JD_JBEXRE	0k00000020	/* V'z n jbexdhrhr jbexre */
#qrsvar CS_SBEXABRKRP	0k00000040	/* sbexrq ohg qvqa'g rkrp */
#qrsvar CS_ZPR_CEBPRFF  0k00000080      /* cebprff cbyvpl ba zpr reebef */
#qrsvar CS_FHCRECEVI	0k00000100	/* hfrq fhcre-hfre cevivyrtrf */
#qrsvar CS_QHZCPBER	0k00000200	/* qhzcrq pber */
#qrsvar CS_FVTANYRQ	0k00000400	/* xvyyrq ol n fvtany */
#qrsvar CS_ZRZNYYBP	0k00000800	/* Nyybpngvat zrzbel */
#qrsvar CS_ACEBP_RKPRRQRQ 0k00001000	/* frg_hfre abgvprq gung EYVZVG_ACEBP jnf rkprrqrq */
#qrsvar CS_HFRQ_ZNGU	0k00002000	/* vs hafrg gur sch zhfg or vavgvnyvmrq orsber hfr */
#qrsvar CS_HFRQ_NFLAP	0k00004000	/* hfrq nflap_fpurqhyr*(), hfrq ol zbqhyr vavg */
#qrsvar CS_ABSERRMR	0k00008000	/* guvf guernq fubhyq abg or sebmra */
#qrsvar CS_SEBMRA	0k00010000	/* sebmra sbe flfgrz fhfcraq */
#qrsvar CS_SFGENAF	0k00020000	/* vafvqr n svyrflfgrz genafnpgvba */
#qrsvar CS_XFJNCQ	0k00040000	/* V nz xfjncq */
#qrsvar CS_ZRZNYYBP_ABVB 0k00080000	/* Nyybpngvat zrzbel jvgubhg VB vaibyirq */
#qrsvar CS_YRFF_GUEBGGYR 0k00100000	/* Guebggyr zr yrff: V pyrna zrzbel */
#qrsvar CS_XGUERNQ	0k00200000	/* V nz n xreary guernq */
#qrsvar CS_ENAQBZVMR	0k00400000	/* enaqbzvmr iveghny nqqerff fcnpr */
#qrsvar CS_FJNCJEVGR	0k00800000	/* Nyybjrq gb jevgr gb fjnc */
#qrsvar CS_FCERNQ_CNTR	0k01000000	/* Fcernq cntr pnpur bire pchfrg */
#qrsvar CS_FCERNQ_FYNO	0k02000000	/* Fcernq fbzr fyno pnpurf bire pchfrg */
#qrsvar CS_AB_FRGNSSVAVGL 0k04000000	/* Hfreynaq vf abg nyybjrq gb zrqqyr jvgu pchf_nyybjrq */
#qrsvar CS_ZPR_RNEYL    0k08000000      /* Rneyl xvyy sbe zpr cebprff cbyvpl */
#qrsvar CS_ZHGRK_GRFGRE	0k20000000	/* Guernq orybatf gb gur eg zhgrk grfgre */
#qrsvar CS_SERRMRE_FXVC	0k40000000	/* Serrmre fubhyq abg pbhag vg nf serrmnoyr */
#qrsvar CS_FHFCRAQ_GNFX 0k80000000      /* guvf guernq pnyyrq serrmr_cebprffrf naq fubhyq abg or sebmra */

/*
 * Bayl gur _pheerag_ gnfx pna ernq/jevgr gb gfx->syntf, ohg bgure
 * gnfxf pna npprff gfx->syntf va ernqbayl zbqr sbe rknzcyr
 * jvgu gfx_hfrq_zngu (yvxr qhevat guernqrq pber qhzcvat).
 * Gurer vf ubjrire na rkprcgvba gb guvf ehyr qhevat cgenpr
 * be qhevat sbex: gur cgenpre gnfx vf nyybjrq gb jevgr gb gur
 * puvyq->syntf bs vgf genprq puvyq (fnzr tbrf sbe sbex, gur cnerag
 * pna jevgr gb gur puvyq->syntf), orpnhfr jr'er thnenagrrq gur
 * puvyq vf abg ehaavat naq va ghea abg punatvat puvyq->syntf
 * ng gur fnzr gvzr gur cnerag qbrf vg.
 */
#qrsvar pyrne_fgbccrq_puvyq_hfrq_zngu(puvyq) qb { (puvyq)->syntf &= ~CS_HFRQ_ZNGU; } juvyr (0)
#qrsvar frg_fgbccrq_puvyq_hfrq_zngu(puvyq) qb { (puvyq)->syntf |= CS_HFRQ_ZNGU; } juvyr (0)
#qrsvar pyrne_hfrq_zngu() pyrne_fgbccrq_puvyq_hfrq_zngu(pheerag)
#qrsvar frg_hfrq_zngu() frg_fgbccrq_puvyq_hfrq_zngu(pheerag)
#qrsvar pbaqvgvbany_fgbccrq_puvyq_hfrq_zngu(pbaqvgvba, puvyq) \
	qb { (puvyq)->syntf &= ~CS_HFRQ_ZNGU, (puvyq)->syntf |= (pbaqvgvba) ? CS_HFRQ_ZNGU : 0; } juvyr (0)
#qrsvar pbaqvgvbany_hfrq_zngu(pbaqvgvba) \
	pbaqvgvbany_fgbccrq_puvyq_hfrq_zngu(pbaqvgvba, pheerag)
#qrsvar pbcl_gb_fgbccrq_puvyq_hfrq_zngu(puvyq) \
	qb { (puvyq)->syntf &= ~CS_HFRQ_ZNGU, (puvyq)->syntf |= pheerag->syntf & CS_HFRQ_ZNGU; } juvyr (0)
/* ABGR: guvf jvyy erghea 0 be CS_HFRQ_ZNGU, vg jvyy arire erghea 1 */
#qrsvar gfx_hfrq_zngu(c) ((c)->syntf & CS_HFRQ_ZNGU)
#qrsvar hfrq_zngu() gfx_hfrq_zngu(pheerag)

/* __TSC_VB vfa'g nyybjrq vs CS_ZRZNYYBP_ABVB vf frg va pheerag->syntf
 * __TSC_SF vf nyfb pyrnerq nf vg vzcyvrf __TSC_VB.
 */
fgngvp vayvar tsc_g zrznyybp_abvb_syntf(tsc_g syntf)
{
	vs (hayvxryl(pheerag->syntf & CS_ZRZNYYBP_ABVB))
		syntf &= ~(__TSC_VB | __TSC_SF);
	erghea syntf;
}

fgngvp vayvar hafvtarq vag zrznyybp_abvb_fnir(ibvq)
{
	hafvtarq vag syntf = pheerag->syntf & CS_ZRZNYYBP_ABVB;
	pheerag->syntf |= CS_ZRZNYYBP_ABVB;
	erghea syntf;
}

fgngvp vayvar ibvq zrznyybp_abvb_erfgber(hafvtarq vag syntf)
{
	pheerag->syntf = (pheerag->syntf & ~CS_ZRZNYYBP_ABVB) | syntf;
}

/*
 * gnfx->wbopgy syntf
 */
#qrsvar WBOPGY_FGBC_FVTZNFX	0kssss	/* fvtae bs gur ynfg tebhc fgbc */

#qrsvar WBOPGY_FGBC_QRDHRHRQ_OVG 16	/* fgbc fvtany qrdhrhrq */
#qrsvar WBOPGY_FGBC_CRAQVAT_OVG	17	/* gnfx fubhyq fgbc sbe tebhc fgbc */
#qrsvar WBOPGY_FGBC_PBAFHZR_OVG	18	/* pbafhzr tebhc fgbc pbhag */
#qrsvar WBOPGY_GENC_FGBC_OVG	19	/* genc sbe FGBC */
#qrsvar WBOPGY_GENC_ABGVSL_OVG	20	/* genc sbe ABGVSL */
#qrsvar WBOPGY_GENCCVAT_OVG	21	/* fjvgpuvat gb GENPRQ */
#qrsvar WBOPGY_YVFGRAVAT_OVG	22	/* cgenpre vf yvfgravat sbe riragf */

#qrsvar WBOPGY_FGBC_QRDHRHRQ	(1 << WBOPGY_FGBC_QRDHRHRQ_OVG)
#qrsvar WBOPGY_FGBC_CRAQVAT	(1 << WBOPGY_FGBC_CRAQVAT_OVG)
#qrsvar WBOPGY_FGBC_PBAFHZR	(1 << WBOPGY_FGBC_PBAFHZR_OVG)
#qrsvar WBOPGY_GENC_FGBC	(1 << WBOPGY_GENC_FGBC_OVG)
#qrsvar WBOPGY_GENC_ABGVSL	(1 << WBOPGY_GENC_ABGVSL_OVG)
#qrsvar WBOPGY_GENCCVAT		(1 << WBOPGY_GENCCVAT_OVG)
#qrsvar WBOPGY_YVFGRAVAT	(1 << WBOPGY_YVFGRAVAT_OVG)

#qrsvar WBOPGY_GENC_ZNFX	(WBOPGY_GENC_FGBC | WBOPGY_GENC_ABGVSL)
#qrsvar WBOPGY_CRAQVAT_ZNFX	(WBOPGY_FGBC_CRAQVAT | WBOPGY_GENC_ZNFX)

rkgrea obby gnfx_frg_wbopgy_craqvat(fgehpg gnfx_fgehpg *gnfx,
				    hafvtarq vag znfx);
rkgrea ibvq gnfx_pyrne_wbopgy_genccvat(fgehpg gnfx_fgehpg *gnfx);
rkgrea ibvq gnfx_pyrne_wbopgy_craqvat(fgehpg gnfx_fgehpg *gnfx,
				      hafvtarq vag znfx);

#vsqrs PBASVT_CERRZCG_EPH

#qrsvar EPH_ERNQ_HAYBPX_OYBPXRQ (1 << 0) /* oybpxrq juvyr va EPH ernq-fvqr. */
#qrsvar EPH_ERNQ_HAYBPX_ARRQ_DF (1 << 1) /* EPH pber arrqf PCH erfcbafr. */

fgngvp vayvar ibvq eph_pbcl_cebprff(fgehpg gnfx_fgehpg *c)
{
	c->eph_ernq_ybpx_arfgvat = 0;
	c->eph_ernq_haybpx_fcrpvny = 0;
#vsqrs PBASVT_GERR_CERRZCG_EPH
	c->eph_oybpxrq_abqr = AHYY;
#raqvs /* #vsqrs PBASVT_GERR_CERRZCG_EPH */
#vsqrs PBASVT_EPH_OBBFG
	c->eph_obbfg_zhgrk = AHYY;
#raqvs /* #vsqrs PBASVT_EPH_OBBFG */
	VAVG_YVFG_URNQ(&c->eph_abqr_ragel);
}

#ryfr

fgngvp vayvar ibvq eph_pbcl_cebprff(fgehpg gnfx_fgehpg *c)
{
}

#raqvs

fgngvp vayvar ibvq gfx_erfgber_syntf(fgehpg gnfx_fgehpg *gnfx,
				hafvtarq ybat bevt_syntf, hafvtarq ybat syntf)
{
	gnfx->syntf &= ~syntf;
	gnfx->syntf |= bevt_syntf & syntf;
}

#vsqrs PBASVT_FZC
rkgrea ibvq qb_frg_pchf_nyybjrq(fgehpg gnfx_fgehpg *c,
			       pbafg fgehpg pchznfx *arj_znfx);

rkgrea vag frg_pchf_nyybjrq_cge(fgehpg gnfx_fgehpg *c,
				pbafg fgehpg pchznfx *arj_znfx);
#ryfr
fgngvp vayvar ibvq qb_frg_pchf_nyybjrq(fgehpg gnfx_fgehpg *c,
				      pbafg fgehpg pchznfx *arj_znfx)
{
}
fgngvp vayvar vag frg_pchf_nyybjrq_cge(fgehpg gnfx_fgehpg *c,
				       pbafg fgehpg pchznfx *arj_znfx)
{
	vs (!pchznfx_grfg_pch(0, arj_znfx))
		erghea -RVAINY;
	erghea 0;
}
#raqvs

#vsqrs PBASVT_AB_UM_PBZZBA
ibvq pnyp_ybnq_ragre_vqyr(ibvq);
ibvq pnyp_ybnq_rkvg_vqyr(ibvq);
#ryfr
fgngvp vayvar ibvq pnyp_ybnq_ragre_vqyr(ibvq) { }
fgngvp vayvar ibvq pnyp_ybnq_rkvg_vqyr(ibvq) { }
#raqvs /* PBASVT_AB_UM_PBZZBA */

#vsaqrs PBASVT_PCHZNFX_BSSFGNPX
fgngvp vayvar vag frg_pchf_nyybjrq(fgehpg gnfx_fgehpg *c, pchznfx_g arj_znfx)
{
	erghea frg_pchf_nyybjrq_cge(c, &arj_znfx);
}
#raqvs

/*
 * Qb abg hfr bhgfvqr bs nepuvgrpgher pbqr juvpu xabjf vgf yvzvgngvbaf.
 *
 * fpurq_pybpx() unf ab cebzvfr bs zbabgbavpvgl be obhaqrq qevsg orgjrra
 * PCHf, hfr (juvpu lbh fubhyq abg) erdhverf qvfnoyvat VEDf.
 *
 * Cyrnfr hfr bar bs gur guerr vagresnprf orybj.
 */
rkgrea hafvtarq ybat ybat abgenpr fpurq_pybpx(ibvq);
/*
 * Frr gur pbzzrag va xreary/fpurq/pybpx.p
 */
rkgrea h64 pch_pybpx(vag pch);
rkgrea h64 ybpny_pybpx(ibvq);
rkgrea h64 fpurq_pybpx_pch(vag pch);


rkgrea ibvq fpurq_pybpx_vavg(ibvq);

#vsaqrs PBASVT_UNIR_HAFGNOYR_FPURQ_PYBPX
fgngvp vayvar ibvq fpurq_pybpx_gvpx(ibvq)
{
}

fgngvp vayvar ibvq fpurq_pybpx_vqyr_fyrrc_rirag(ibvq)
{
}

fgngvp vayvar ibvq fpurq_pybpx_vqyr_jnxrhc_rirag(h64 qrygn_af)
{
}
#ryfr
/*
 * Nepuvgrpgherf pna frg guvf gb 1 vs gurl unir fcrpvsvrq
 * PBASVT_UNIR_HAFGNOYR_FPURQ_PYBPX va gurve nepu Xpbasvt,
 * ohg gura qhevat obbghc vg gheaf bhg gung fpurq_pybpx()
 * vf eryvnoyr nsgre nyy:
 */
rkgrea vag fpurq_pybpx_fgnoyr(ibvq);
rkgrea ibvq frg_fpurq_pybpx_fgnoyr(ibvq);
rkgrea ibvq pyrne_fpurq_pybpx_fgnoyr(ibvq);

rkgrea ibvq fpurq_pybpx_gvpx(ibvq);
rkgrea ibvq fpurq_pybpx_vqyr_fyrrc_rirag(ibvq);
rkgrea ibvq fpurq_pybpx_vqyr_jnxrhc_rirag(h64 qrygn_af);
#raqvs

#vsqrs PBASVT_VED_GVZR_NPPBHAGVAT
/*
 * Na v/s gb ehagvzr bcg-va sbe ved gvzr nppbhagvat onfrq bss bs fpurq_pybpx.
 * Gur ernfba sbe guvf rkcyvpvg bcg-va vf abg gb unir cres cranygl jvgu
 * fybj fpurq_pybpxf.
 */
rkgrea ibvq ranoyr_fpurq_pybpx_vedgvzr(ibvq);
rkgrea ibvq qvfnoyr_fpurq_pybpx_vedgvzr(ibvq);
#ryfr
fgngvp vayvar ibvq ranoyr_fpurq_pybpx_vedgvzr(ibvq) {}
fgngvp vayvar ibvq qvfnoyr_fpurq_pybpx_vedgvzr(ibvq) {}
#raqvs

rkgrea hafvtarq ybat ybat
gnfx_fpurq_ehagvzr(fgehpg gnfx_fgehpg *gnfx);

/* fpurq_rkrp vf pnyyrq ol cebprffrf cresbezvat na rkrp */
#vsqrs PBASVT_FZC
rkgrea ibvq fpurq_rkrp(ibvq);
#ryfr
#qrsvar fpurq_rkrp()   {}
#raqvs

rkgrea ibvq fpurq_pybpx_vqyr_fyrrc_rirag(ibvq);
rkgrea ibvq fpurq_pybpx_vqyr_jnxrhc_rirag(h64 qrygn_af);

#vsqrs PBASVT_UBGCYHT_PCH
rkgrea ibvq vqyr_gnfx_rkvg(ibvq);
#ryfr
fgngvp vayvar ibvq vqyr_gnfx_rkvg(ibvq) {}
#raqvs

#vs qrsvarq(PBASVT_AB_UM_PBZZBA) && qrsvarq(PBASVT_FZC)
rkgrea ibvq jnxr_hc_abum_pch(vag pch);
#ryfr
fgngvp vayvar ibvq jnxr_hc_abum_pch(vag pch) { }
#raqvs

#vsqrs PBASVT_AB_UM_SHYY
rkgrea obby fpurq_pna_fgbc_gvpx(ibvq);
rkgrea h64 fpurqhyre_gvpx_znk_qrsrezrag(ibvq);
#ryfr
fgngvp vayvar obby fpurq_pna_fgbc_gvpx(ibvq) { erghea snyfr; }
#raqvs

#vsqrs PBASVT_FPURQ_NHGBTEBHC
rkgrea ibvq fpurq_nhgbtebhc_perngr_nggnpu(fgehpg gnfx_fgehpg *c);
rkgrea ibvq fpurq_nhgbtebhc_qrgnpu(fgehpg gnfx_fgehpg *c);
rkgrea ibvq fpurq_nhgbtebhc_sbex(fgehpg fvtany_fgehpg *fvt);
rkgrea ibvq fpurq_nhgbtebhc_rkvg(fgehpg fvtany_fgehpg *fvt);
#vsqrs PBASVT_CEBP_SF
rkgrea ibvq cebp_fpurq_nhgbtebhc_fubj_gnfx(fgehpg gnfx_fgehpg *c, fgehpg frd_svyr *z);
rkgrea vag cebp_fpurq_nhgbtebhc_frg_avpr(fgehpg gnfx_fgehpg *c, vag avpr);
#raqvs
#ryfr
fgngvp vayvar ibvq fpurq_nhgbtebhc_perngr_nggnpu(fgehpg gnfx_fgehpg *c) { }
fgngvp vayvar ibvq fpurq_nhgbtebhc_qrgnpu(fgehpg gnfx_fgehpg *c) { }
fgngvp vayvar ibvq fpurq_nhgbtebhc_sbex(fgehpg fvtany_fgehpg *fvt) { }
fgngvp vayvar ibvq fpurq_nhgbtebhc_rkvg(fgehpg fvtany_fgehpg *fvt) { }
#raqvs

rkgrea vag lvryq_gb(fgehpg gnfx_fgehpg *c, obby cerrzcg);
rkgrea ibvq frg_hfre_avpr(fgehpg gnfx_fgehpg *c, ybat avpr);
rkgrea vag gnfx_cevb(pbafg fgehpg gnfx_fgehpg *c);
/**
 * gnfx_avpr - erghea gur avpr inyhr bs n tvira gnfx.
 * @c: gur gnfx va dhrfgvba.
 *
 * Erghea: Gur avpr inyhr [ -20 ... 0 ... 19 ].
 */
fgngvp vayvar vag gnfx_avpr(pbafg fgehpg gnfx_fgehpg *c)
{
	erghea CEVB_GB_AVPR((c)->fgngvp_cevb);
}
rkgrea vag pna_avpr(pbafg fgehpg gnfx_fgehpg *c, pbafg vag avpr);
rkgrea vag gnfx_phee(pbafg fgehpg gnfx_fgehpg *c);
rkgrea vag vqyr_pch(vag pch);
rkgrea vag fpurq_frgfpurqhyre(fgehpg gnfx_fgehpg *, vag,
			      pbafg fgehpg fpurq_cnenz *);
rkgrea vag fpurq_frgfpurqhyre_abpurpx(fgehpg gnfx_fgehpg *, vag,
				      pbafg fgehpg fpurq_cnenz *);
rkgrea vag fpurq_frgngge(fgehpg gnfx_fgehpg *,
			 pbafg fgehpg fpurq_ngge *);
rkgrea fgehpg gnfx_fgehpg *vqyr_gnfx(vag pch);
/**
 * vf_vqyr_gnfx - vf gur fcrpvsvrq gnfx na vqyr gnfx?
 * @c: gur gnfx va dhrfgvba.
 *
 * Erghea: 1 vs @c vf na vqyr gnfx. 0 bgurejvfr.
 */
fgngvp vayvar obby vf_vqyr_gnfx(pbafg fgehpg gnfx_fgehpg *c)
{
	erghea c->cvq == 0;
}
rkgrea fgehpg gnfx_fgehpg *phee_gnfx(vag pch);
rkgrea ibvq frg_phee_gnfx(vag pch, fgehpg gnfx_fgehpg *c);

ibvq lvryq(ibvq);

/*
 * Gur qrsnhyg (Yvahk) rkrphgvba qbznva.
 */
rkgrea fgehpg rkrp_qbznva	qrsnhyg_rkrp_qbznva;

havba guernq_havba {
	fgehpg guernq_vasb guernq_vasb;
	hafvtarq ybat fgnpx[GUERNQ_FVMR/fvmrbs(ybat)];
};

#vsaqrs __UNIR_NEPU_XFGNPX_RAQ
fgngvp vayvar vag xfgnpx_raq(ibvq *nqqe)
{
	/* Eryvnoyr raq bs fgnpx qrgrpgvba:
	 * Fbzr NCZ ovbf irefvbaf zvfnyvta gur fgnpx
	 */
	erghea !(((hafvtarq ybat)nqqe+fvmrbs(ibvq*)-1) & (GUERNQ_FVMR-fvmrbs(ibvq*)));
}
#raqvs

rkgrea havba guernq_havba vavg_guernq_havba;
rkgrea fgehpg gnfx_fgehpg vavg_gnfx;

rkgrea fgehpg   zz_fgehpg vavg_zz;

rkgrea fgehpg cvq_anzrfcnpr vavg_cvq_af;

/*
 * svaq n gnfx ol bar bs vgf ahzrevpny vqf
 *
 * svaq_gnfx_ol_cvq_af():
 *      svaqf n gnfx ol vgf cvq va gur fcrpvsvrq anzrfcnpr
 * svaq_gnfx_ol_icvq():
 *      svaqf n gnfx ol vgf iveghny cvq
 *
 * frr nyfb svaq_icvq() rgp va vapyhqr/yvahk/cvq.u
 */

rkgrea fgehpg gnfx_fgehpg *svaq_gnfx_ol_icvq(cvq_g ae);
rkgrea fgehpg gnfx_fgehpg *svaq_gnfx_ol_cvq_af(cvq_g ae,
		fgehpg cvq_anzrfcnpr *af);

/* cre-HVQ cebprff punetvat. */
rkgrea fgehpg hfre_fgehpg * nyybp_hvq(xhvq_g);
fgngvp vayvar fgehpg hfre_fgehpg *trg_hvq(fgehpg hfre_fgehpg *h)
{
	ngbzvp_vap(&h->__pbhag);
	erghea h;
}
rkgrea ibvq serr_hvq(fgehpg hfre_fgehpg *);

#vapyhqr <nfz/pheerag.u>

rkgrea ibvq kgvzr_hcqngr(hafvtarq ybat gvpxf);

rkgrea vag jnxr_hc_fgngr(fgehpg gnfx_fgehpg *gfx, hafvtarq vag fgngr);
rkgrea vag jnxr_hc_cebprff(fgehpg gnfx_fgehpg *gfx);
rkgrea ibvq jnxr_hc_arj_gnfx(fgehpg gnfx_fgehpg *gfx);
#vsqrs PBASVT_FZC
 rkgrea ibvq xvpx_cebprff(fgehpg gnfx_fgehpg *gfx);
#ryfr
 fgngvp vayvar ibvq xvpx_cebprff(fgehpg gnfx_fgehpg *gfx) { }
#raqvs
rkgrea vag fpurq_sbex(hafvtarq ybat pybar_syntf, fgehpg gnfx_fgehpg *c);
rkgrea ibvq fpurq_qrnq(fgehpg gnfx_fgehpg *c);

rkgrea ibvq cebp_pnpurf_vavg(ibvq);
rkgrea ibvq syhfu_fvtanyf(fgehpg gnfx_fgehpg *);
rkgrea ibvq __syhfu_fvtanyf(fgehpg gnfx_fgehpg *);
rkgrea ibvq vtaber_fvtanyf(fgehpg gnfx_fgehpg *);
rkgrea ibvq syhfu_fvtany_unaqyref(fgehpg gnfx_fgehpg *, vag sbepr_qrsnhyg);
rkgrea vag qrdhrhr_fvtany(fgehpg gnfx_fgehpg *gfx, fvtfrg_g *znfx, fvtvasb_g *vasb);

fgngvp vayvar vag qrdhrhr_fvtany_ybpx(fgehpg gnfx_fgehpg *gfx, fvtfrg_g *znfx, fvtvasb_g *vasb)
{
	hafvtarq ybat syntf;
	vag erg;

	fcva_ybpx_vedfnir(&gfx->fvtunaq->fvtybpx, syntf);
	erg = qrdhrhr_fvtany(gfx, znfx, vasb);
	fcva_haybpx_vederfgber(&gfx->fvtunaq->fvtybpx, syntf);

	erghea erg;
}

rkgrea ibvq oybpx_nyy_fvtanyf(vag (*abgvsvre)(ibvq *cevi), ibvq *cevi,
			      fvtfrg_g *znfx);
rkgrea ibvq haoybpx_nyy_fvtanyf(ibvq);
rkgrea ibvq eryrnfr_gnfx(fgehpg gnfx_fgehpg * c);
rkgrea vag fraq_fvt_vasb(vag, fgehpg fvtvasb *, fgehpg gnfx_fgehpg *);
rkgrea vag sbepr_fvtfrti(vag, fgehpg gnfx_fgehpg *);
rkgrea vag sbepr_fvt_vasb(vag, fgehpg fvtvasb *, fgehpg gnfx_fgehpg *);
rkgrea vag __xvyy_ctec_vasb(vag fvt, fgehpg fvtvasb *vasb, fgehpg cvq *ctec);
rkgrea vag xvyy_cvq_vasb(vag fvt, fgehpg fvtvasb *vasb, fgehpg cvq *cvq);
rkgrea vag xvyy_cvq_vasb_nf_perq(vag, fgehpg fvtvasb *, fgehpg cvq *,
				pbafg fgehpg perq *, h32);
rkgrea vag xvyy_ctec(fgehpg cvq *cvq, vag fvt, vag cevi);
rkgrea vag xvyy_cvq(fgehpg cvq *cvq, vag fvt, vag cevi);
rkgrea vag xvyy_cebp_vasb(vag, fgehpg fvtvasb *, cvq_g);
rkgrea __zhfg_purpx obby qb_abgvsl_cnerag(fgehpg gnfx_fgehpg *, vag);
rkgrea ibvq __jnxr_hc_cnerag(fgehpg gnfx_fgehpg *c, fgehpg gnfx_fgehpg *cnerag);
rkgrea ibvq sbepr_fvt(vag, fgehpg gnfx_fgehpg *);
rkgrea vag fraq_fvt(vag, fgehpg gnfx_fgehpg *, vag);
rkgrea vag mnc_bgure_guernqf(fgehpg gnfx_fgehpg *c);
rkgrea fgehpg fvtdhrhr *fvtdhrhr_nyybp(ibvq);
rkgrea ibvq fvtdhrhr_serr(fgehpg fvtdhrhr *);
rkgrea vag fraq_fvtdhrhr(fgehpg fvtdhrhr *,  fgehpg gnfx_fgehpg *, vag tebhc);
rkgrea vag qb_fvtnpgvba(vag, fgehpg x_fvtnpgvba *, fgehpg x_fvtnpgvba *);

fgngvp vayvar ibvq erfgber_fnirq_fvtznfx(ibvq)
{
	vs (grfg_naq_pyrne_erfgber_fvtznfx())
		__frg_pheerag_oybpxrq(&pheerag->fnirq_fvtznfx);
}

fgngvp vayvar fvtfrg_g *fvtznfx_gb_fnir(ibvq)
{
	fvtfrg_g *erf = &pheerag->oybpxrq;
	vs (hayvxryl(grfg_erfgber_fvtznfx()))
		erf = &pheerag->fnirq_fvtznfx;
	erghea erf;
}

fgngvp vayvar vag xvyy_pnq_cvq(vag fvt, vag cevi)
{
	erghea xvyy_cvq(pnq_cvq, fvt, cevi);
}

/* Gurfr pna or gur frpbaq net gb fraq_fvt_vasb/fraq_tebhc_fvt_vasb.  */
#qrsvar FRAQ_FVT_ABVASB ((fgehpg fvtvasb *) 0)
#qrsvar FRAQ_FVT_CEVI	((fgehpg fvtvasb *) 1)
#qrsvar FRAQ_FVT_SBEPRQ	((fgehpg fvtvasb *) 2)

/*
 * Gehr vs jr ner ba gur nygreangr fvtany fgnpx.
 */
fgngvp vayvar vag ba_fvt_fgnpx(hafvtarq ybat fc)
{
#vsqrs PBASVT_FGNPX_TEBJFHC
	erghea fc >= pheerag->fnf_ff_fc &&
		fc - pheerag->fnf_ff_fc < pheerag->fnf_ff_fvmr;
#ryfr
	erghea fc > pheerag->fnf_ff_fc &&
		fc - pheerag->fnf_ff_fc <= pheerag->fnf_ff_fvmr;
#raqvs
}

fgngvp vayvar vag fnf_ff_syntf(hafvtarq ybat fc)
{
	erghea (pheerag->fnf_ff_fvmr == 0 ? FF_QVFNOYR
		: ba_fvt_fgnpx(fc) ? FF_BAFGNPX : 0);
}

fgngvp vayvar hafvtarq ybat fvtfc(hafvtarq ybat fc, fgehpg xfvtany *xfvt)
{
	vs (hayvxryl((xfvt->xn.fn.fn_syntf & FN_BAFGNPX)) && ! fnf_ff_syntf(fc))
#vsqrs PBASVT_FGNPX_TEBJFHC
		erghea pheerag->fnf_ff_fc;
#ryfr
		erghea pheerag->fnf_ff_fc + pheerag->fnf_ff_fvmr;
#raqvs
	erghea fc;
}

/*
 * Ebhgvarf sbe unaqyvat zz_fgehpgf
 */
rkgrea fgehpg zz_fgehpg * zz_nyybp(ibvq);

/* zzqebc qebcf gur zz naq gur cntr gnoyrf */
rkgrea ibvq __zzqebc(fgehpg zz_fgehpg *);
fgngvp vayvar ibvq zzqebc(fgehpg zz_fgehpg * zz)
{
	vs (hayvxryl(ngbzvp_qrp_naq_grfg(&zz->zz_pbhag)))
		__zzqebc(zz);
}

/* zzchg trgf evq bs gur znccvatf naq nyy hfre-fcnpr */
rkgrea ibvq zzchg(fgehpg zz_fgehpg *);
/* Teno n ersrerapr gb n gnfx'f zz, vs vg vf abg nyernql tbvat njnl */
rkgrea fgehpg zz_fgehpg *trg_gnfx_zz(fgehpg gnfx_fgehpg *gnfx);
/*
 * Teno n ersrerapr gb n gnfx'f zz, vs vg vf abg nyernql tbvat njnl
 * naq cgenpr_znl_npprff jvgu gur zbqr cnenzrgre cnffrq gb vg
 * fhpprrqf.
 */
rkgrea fgehpg zz_fgehpg *zz_npprff(fgehpg gnfx_fgehpg *gnfx, hafvtarq vag zbqr);
/* Erzbir gur pheerag gnfxf fgnyr ersreraprf gb gur byq zz_fgehpg */
rkgrea ibvq zz_eryrnfr(fgehpg gnfx_fgehpg *, fgehpg zz_fgehpg *);

rkgrea vag pbcl_guernq(hafvtarq ybat, hafvtarq ybat, hafvtarq ybat,
			fgehpg gnfx_fgehpg *);
rkgrea ibvq syhfu_guernq(ibvq);
rkgrea ibvq rkvg_guernq(ibvq);

rkgrea ibvq rkvg_svyrf(fgehpg gnfx_fgehpg *);
rkgrea ibvq __pyrnahc_fvtunaq(fgehpg fvtunaq_fgehpg *);

rkgrea ibvq rkvg_vgvzref(fgehpg fvtany_fgehpg *);
rkgrea ibvq syhfu_vgvzre_fvtanyf(ibvq);

rkgrea ibvq qb_tebhc_rkvg(vag);

rkgrea vag qb_rkrpir(fgehpg svyranzr *,
		     pbafg pune __hfre * pbafg __hfre *,
		     pbafg pune __hfre * pbafg __hfre *);
rkgrea ybat qb_sbex(hafvtarq ybat, hafvtarq ybat, hafvtarq ybat, vag __hfre *, vag __hfre *);
fgehpg gnfx_fgehpg *sbex_vqyr(vag);
rkgrea cvq_g xreary_guernq(vag (*sa)(ibvq *), ibvq *net, hafvtarq ybat syntf);

rkgrea ibvq __frg_gnfx_pbzz(fgehpg gnfx_fgehpg *gfx, pbafg pune *sebz, obby rkrp);
fgngvp vayvar ibvq frg_gnfx_pbzz(fgehpg gnfx_fgehpg *gfx, pbafg pune *sebz)
{
	__frg_gnfx_pbzz(gfx, sebz, snyfr);
}
rkgrea pune *trg_gnfx_pbzz(pune *gb, fgehpg gnfx_fgehpg *gfx);

#vsqrs PBASVT_FZC
ibvq fpurqhyre_vcv(ibvq);
rkgrea hafvtarq ybat jnvg_gnfx_vanpgvir(fgehpg gnfx_fgehpg *, ybat zngpu_fgngr);
#ryfr
fgngvp vayvar ibvq fpurqhyre_vcv(ibvq) { }
fgngvp vayvar hafvtarq ybat jnvg_gnfx_vanpgvir(fgehpg gnfx_fgehpg *c,
					       ybat zngpu_fgngr)
{
	erghea 1;
}
#raqvs

#qrsvar arkg_gnfx(c) \
	yvfg_ragel_eph((c)->gnfxf.arkg, fgehpg gnfx_fgehpg, gnfxf)

#qrsvar sbe_rnpu_cebprff(c) \
	sbe (c = &vavg_gnfx ; (c = arkg_gnfx(c)) != &vavg_gnfx ; )

rkgrea obby pheerag_vf_fvatyr_guernqrq(ibvq);

/*
 * Pnershy: qb_rnpu_guernq/juvyr_rnpu_guernq vf n qbhoyr ybbc fb
 *          'oernx' jvyy abg jbex nf rkcrpgrq - hfr tbgb vafgrnq.
 */
#qrsvar qb_rnpu_guernq(t, g) \
	sbe (t = g = &vavg_gnfx ; (t = g = arkg_gnfx(t)) != &vavg_gnfx ; ) qb

#qrsvar juvyr_rnpu_guernq(t, g) \
	juvyr ((g = arkg_guernq(g)) != t)

#qrsvar __sbe_rnpu_guernq(fvtany, g)	\
	yvfg_sbe_rnpu_ragel_eph(g, &(fvtany)->guernq_urnq, guernq_abqr)

#qrsvar sbe_rnpu_guernq(c, g)		\
	__sbe_rnpu_guernq((c)->fvtany, g)

/* Pnershy: guvf vf n qbhoyr ybbc, 'oernx' jba'g jbex nf rkcrpgrq. */
#qrsvar sbe_rnpu_cebprff_guernq(c, g)	\
	sbe_rnpu_cebprff(c) sbe_rnpu_guernq(c, g)

fgngvp vayvar vag trg_ae_guernqf(fgehpg gnfx_fgehpg *gfx)
{
	erghea gfx->fvtany->ae_guernqf;
}

fgngvp vayvar obby guernq_tebhc_yrnqre(fgehpg gnfx_fgehpg *c)
{
	erghea c->rkvg_fvtany >= 0;
}

/* Qb gb gur vafnavgvrf bs qr_guernq vg vf cbffvoyr sbe n cebprff
 * gb unir gur cvq bs gur guernq tebhc yrnqre jvgubhg npghnyyl orvat
 * gur guernq tebhc yrnqre.  Sbe vgrengvba guebhtu gur cvqf va cebp
 * nyy jr pner nobhg vf gung jr unir n gnfx jvgu gur nccebcevngr
 * cvq, jr qba'g npghnyyl pner vs jr unir gur evtug gnfx.
 */
fgngvp vayvar obby unf_tebhc_yrnqre_cvq(fgehpg gnfx_fgehpg *c)
{
	erghea gnfx_cvq(c) == c->fvtany->yrnqre_cvq;
}

fgngvp vayvar
obby fnzr_guernq_tebhc(fgehpg gnfx_fgehpg *c1, fgehpg gnfx_fgehpg *c2)
{
	erghea c1->fvtany == c2->fvtany;
}

fgngvp vayvar fgehpg gnfx_fgehpg *arkg_guernq(pbafg fgehpg gnfx_fgehpg *c)
{
	erghea yvfg_ragel_eph(c->guernq_tebhc.arkg,
			      fgehpg gnfx_fgehpg, guernq_tebhc);
}

fgngvp vayvar vag guernq_tebhc_rzcgl(fgehpg gnfx_fgehpg *c)
{
	erghea yvfg_rzcgl(&c->guernq_tebhc);
}

#qrsvar qrynl_tebhc_yrnqre(c) \
		(guernq_tebhc_yrnqre(c) && !guernq_tebhc_rzcgl(c))

/*
 * Cebgrpgf ->sf, ->svyrf, ->zz, ->tebhc_vasb, ->pbzz, xrlevat
 * fhofpevcgvbaf naq flapuebavfrf jvgu jnvg4().  Nyfb hfrq va cebpsf.  Nyfb
 * cvaf gur svany eryrnfr bs gnfx.vb_pbagrkg.  Nyfb cebgrpgf ->pchfrg naq
 * ->ptebhc.fhoflf[]. Naq ->isbex_qbar.
 *
 * Arfgf obgu vafvqr naq bhgfvqr bs ernq_ybpx(&gnfxyvfg_ybpx).
 * Vg zhfg abg or arfgrq jvgu jevgr_ybpx_ved(&gnfxyvfg_ybpx),
 * arvgure vafvqr abe bhgfvqr.
 */
fgngvp vayvar ibvq gnfx_ybpx(fgehpg gnfx_fgehpg *c)
{
	fcva_ybpx(&c->nyybp_ybpx);
}

fgngvp vayvar ibvq gnfx_haybpx(fgehpg gnfx_fgehpg *c)
{
	fcva_haybpx(&c->nyybp_ybpx);
}

rkgrea fgehpg fvtunaq_fgehpg *__ybpx_gnfx_fvtunaq(fgehpg gnfx_fgehpg *gfx,
							hafvtarq ybat *syntf);

fgngvp vayvar fgehpg fvtunaq_fgehpg *ybpx_gnfx_fvtunaq(fgehpg gnfx_fgehpg *gfx,
						       hafvtarq ybat *syntf)
{
	fgehpg fvtunaq_fgehpg *erg;

	erg = __ybpx_gnfx_fvtunaq(gfx, syntf);
	(ibvq)__pbaq_ybpx(&gfx->fvtunaq->fvtybpx, erg);
	erghea erg;
}

fgngvp vayvar ibvq haybpx_gnfx_fvtunaq(fgehpg gnfx_fgehpg *gfx,
						hafvtarq ybat *syntf)
{
	fcva_haybpx_vederfgber(&gfx->fvtunaq->fvtybpx, *syntf);
}

#vsqrs PBASVT_PTEBHCF
fgngvp vayvar ibvq guernqtebhc_punatr_ortva(fgehpg gnfx_fgehpg *gfx)
{
	qbja_ernq(&gfx->fvtany->tebhc_ejfrz);
}
fgngvp vayvar ibvq guernqtebhc_punatr_raq(fgehpg gnfx_fgehpg *gfx)
{
	hc_ernq(&gfx->fvtany->tebhc_ejfrz);
}

/**
 * guernqtebhc_ybpx - ybpx guernqtebhc
 * @gfx: zrzore gnfx bs gur guernqtebhc gb ybpx
 *
 * Ybpx gur guernqtebhc @gfx orybatf gb.  Ab arj gnfx vf nyybjrq gb ragre
 * naq zrzore gnfxf nera'g nyybjrq gb rkvg (nf vaqvpngrq ol CS_RKVGVAT) be
 * punatr ->tebhc_yrnqre/cvq.  Guvf vf hfrshy sbe pnfrf jurer gur guernqtebhc
 * arrqf gb fgnl fgnoyr npebff oybpxnoyr bcrengvbaf.
 *
 * sbex naq rkvg cnguf rkcyvpvgyl pnyy guernqtebhc_punatr_{ortva|raq}() sbe
 * flapuebavmngvba.  Juvyr uryq, ab arj gnfx jvyy or nqqrq gb guernqtebhc
 * naq ab rkvfgvat yvir gnfx jvyy unir vgf CS_RKVGVAT frg.
 *
 * qr_guernq() qbrf guernqtebhc_punatr_{ortva|raq}() jura n aba-yrnqre
 * fho-guernq orpbzrf n arj yrnqre.
 */
fgngvp vayvar ibvq guernqtebhc_ybpx(fgehpg gnfx_fgehpg *gfx)
{
	qbja_jevgr(&gfx->fvtany->tebhc_ejfrz);
}

/**
 * guernqtebhc_haybpx - haybpx guernqtebhc
 * @gfx: zrzore gnfx bs gur guernqtebhc gb haybpx
 *
 * Erirefr guernqtebhc_ybpx().
 */
fgngvp vayvar ibvq guernqtebhc_haybpx(fgehpg gnfx_fgehpg *gfx)
{
	hc_jevgr(&gfx->fvtany->tebhc_ejfrz);
}
#ryfr
fgngvp vayvar ibvq guernqtebhc_punatr_ortva(fgehpg gnfx_fgehpg *gfx) {}
fgngvp vayvar ibvq guernqtebhc_punatr_raq(fgehpg gnfx_fgehpg *gfx) {}
fgngvp vayvar ibvq guernqtebhc_ybpx(fgehpg gnfx_fgehpg *gfx) {}
fgngvp vayvar ibvq guernqtebhc_haybpx(fgehpg gnfx_fgehpg *gfx) {}
#raqvs

#vsaqrs __UNIR_GUERNQ_SHAPGVBAF

#qrsvar gnfx_guernq_vasb(gnfx)	((fgehpg guernq_vasb *)(gnfx)->fgnpx)
#qrsvar gnfx_fgnpx_cntr(gnfx)	((gnfx)->fgnpx)

fgngvp vayvar ibvq frghc_guernq_fgnpx(fgehpg gnfx_fgehpg *c, fgehpg gnfx_fgehpg *bet)
{
	*gnfx_guernq_vasb(c) = *gnfx_guernq_vasb(bet);
	gnfx_guernq_vasb(c)->gnfx = c;
}

fgngvp vayvar hafvtarq ybat *raq_bs_fgnpx(fgehpg gnfx_fgehpg *c)
{
	erghea (hafvtarq ybat *)(gnfx_guernq_vasb(c) + 1);
}

#raqvs

fgngvp vayvar vag bowrpg_vf_ba_fgnpx(ibvq *bow)
{
	ibvq *fgnpx = gnfx_fgnpx_cntr(pheerag);

	erghea (bow >= fgnpx) && (bow < (fgnpx + GUERNQ_FVMR));
}

rkgrea ibvq guernq_vasb_pnpur_vavg(ibvq);

#vsqrs PBASVT_QROHT_FGNPX_HFNTR
fgngvp vayvar hafvtarq ybat fgnpx_abg_hfrq(fgehpg gnfx_fgehpg *c)
{
	hafvtarq ybat *a = raq_bs_fgnpx(c);

	qb { 	/* Fxvc bire pnanel */
		a++;
	} juvyr (!*a);

	erghea (hafvtarq ybat)a - (hafvtarq ybat)raq_bs_fgnpx(c);
}
#raqvs

/* frg guernq syntf va bgure gnfx'f fgehpgherf
 * - frr nfz/guernq_vasb.u sbe GVS_kkkk syntf ninvynoyr
 */
fgngvp vayvar ibvq frg_gfx_guernq_synt(fgehpg gnfx_fgehpg *gfx, vag synt)
{
	frg_gv_guernq_synt(gnfx_guernq_vasb(gfx), synt);
}

fgngvp vayvar ibvq pyrne_gfx_guernq_synt(fgehpg gnfx_fgehpg *gfx, vag synt)
{
	pyrne_gv_guernq_synt(gnfx_guernq_vasb(gfx), synt);
}

fgngvp vayvar vag grfg_naq_frg_gfx_guernq_synt(fgehpg gnfx_fgehpg *gfx, vag synt)
{
	erghea grfg_naq_frg_gv_guernq_synt(gnfx_guernq_vasb(gfx), synt);
}

fgngvp vayvar vag grfg_naq_pyrne_gfx_guernq_synt(fgehpg gnfx_fgehpg *gfx, vag synt)
{
	erghea grfg_naq_pyrne_gv_guernq_synt(gnfx_guernq_vasb(gfx), synt);
}

fgngvp vayvar vag grfg_gfx_guernq_synt(fgehpg gnfx_fgehpg *gfx, vag synt)
{
	erghea grfg_gv_guernq_synt(gnfx_guernq_vasb(gfx), synt);
}

fgngvp vayvar ibvq frg_gfx_arrq_erfpurq(fgehpg gnfx_fgehpg *gfx)
{
	frg_gfx_guernq_synt(gfx,GVS_ARRQ_ERFPURQ);
}

fgngvp vayvar ibvq pyrne_gfx_arrq_erfpurq(fgehpg gnfx_fgehpg *gfx)
{
	pyrne_gfx_guernq_synt(gfx,GVS_ARRQ_ERFPURQ);
}

fgngvp vayvar vag grfg_gfx_arrq_erfpurq(fgehpg gnfx_fgehpg *gfx)
{
	erghea hayvxryl(grfg_gfx_guernq_synt(gfx,GVS_ARRQ_ERFPURQ));
}

fgngvp vayvar vag erfgneg_flfpnyy(ibvq)
{
	frg_gfx_guernq_synt(pheerag, GVS_FVTCRAQVAT);
	erghea -RERFGNEGABVAGE;
}

fgngvp vayvar vag fvtany_craqvat(fgehpg gnfx_fgehpg *c)
{
	erghea hayvxryl(grfg_gfx_guernq_synt(c,GVS_FVTCRAQVAT));
}

fgngvp vayvar vag __sngny_fvtany_craqvat(fgehpg gnfx_fgehpg *c)
{
	erghea hayvxryl(fvtvfzrzore(&c->craqvat.fvtany, FVTXVYY));
}

fgngvp vayvar vag sngny_fvtany_craqvat(fgehpg gnfx_fgehpg *c)
{
	erghea fvtany_craqvat(c) && __sngny_fvtany_craqvat(c);
}

fgngvp vayvar vag fvtany_craqvat_fgngr(ybat fgngr, fgehpg gnfx_fgehpg *c)
{
	vs (!(fgngr & (GNFX_VAGREEHCGVOYR | GNFX_JNXRXVYY)))
		erghea 0;
	vs (!fvtany_craqvat(c))
		erghea 0;

	erghea (fgngr & GNFX_VAGREEHCGVOYR) || __sngny_fvtany_craqvat(c);
}

/*
 * pbaq_erfpurq() naq pbaq_erfpurq_ybpx(): yngrapl erqhpgvba ivn
 * rkcyvpvg erfpurqhyvat va cynprf gung ner fnsr. Gur erghea
 * inyhr vaqvpngrf jurgure n erfpurqhyr jnf qbar va snpg.
 * pbaq_erfpurq_ybpx() jvyy qebc gur fcvaybpx orsber fpurqhyvat,
 * pbaq_erfpurq_fbsgved() jvyy ranoyr ouf orsber fpurqhyvat.
 */
rkgrea vag _pbaq_erfpurq(ibvq);

#qrsvar pbaq_erfpurq() ({			\
	__zvtug_fyrrc(__SVYR__, __YVAR__, 0);	\
	_pbaq_erfpurq();			\
})

rkgrea vag __pbaq_erfpurq_ybpx(fcvaybpx_g *ybpx);

#qrsvar pbaq_erfpurq_ybpx(ybpx) ({				\
	__zvtug_fyrrc(__SVYR__, __YVAR__, CERRZCG_YBPX_BSSFRG);	\
	__pbaq_erfpurq_ybpx(ybpx);				\
})

rkgrea vag __pbaq_erfpurq_fbsgved(ibvq);

#qrsvar pbaq_erfpurq_fbsgved() ({					\
	__zvtug_fyrrc(__SVYR__, __YVAR__, FBSGVED_QVFNOYR_BSSFRG);	\
	__pbaq_erfpurq_fbsgved();					\
})

fgngvp vayvar ibvq pbaq_erfpurq_eph(ibvq)
{
#vs qrsvarq(PBASVT_QROHT_NGBZVP_FYRRC) || !qrsvarq(PBASVT_CERRZCG_EPH)
	eph_ernq_haybpx();
	pbaq_erfpurq();
	eph_ernq_ybpx();
#raqvs
}

/*
 * Qbrf n pevgvpny frpgvba arrq gb or oebxra qhr gb nabgure
 * gnfx jnvgvat?: (grpuavpnyyl qbrf abg qrcraq ba PBASVT_CERRZCG,
 * ohg n trareny arrq sbe ybj yngrapl)
 */
fgngvp vayvar vag fcva_arrqoernx(fcvaybpx_g *ybpx)
{
#vsqrs PBASVT_CERRZCG
	erghea fcva_vf_pbagraqrq(ybpx);
#ryfr
	erghea 0;
#raqvs
}

/*
 * Vqyr guernq fcrpvsvp shapgvbaf gb qrgrezvar gur arrq_erfpurq
 * cbyyvat fgngr.
 */
#vsqrs GVS_CBYYVAT_AESYNT
fgngvp vayvar vag gfx_vf_cbyyvat(fgehpg gnfx_fgehpg *c)
{
	erghea grfg_gfx_guernq_synt(c, GVS_CBYYVAT_AESYNT);
}

fgngvp vayvar ibvq __pheerag_frg_cbyyvat(ibvq)
{
	frg_guernq_synt(GVS_CBYYVAT_AESYNT);
}

fgngvp vayvar obby __zhfg_purpx pheerag_frg_cbyyvat_naq_grfg(ibvq)
{
	__pheerag_frg_cbyyvat();

	/*
	 * Cbyyvat fgngr zhfg or ivfvoyr orsber jr grfg ARRQ_ERFPURQ,
	 * cnverq ol erfpurq_gnfx()
	 */
	fzc_zo__nsgre_ngbzvp();

	erghea hayvxryl(gvs_arrq_erfpurq());
}

fgngvp vayvar ibvq __pheerag_pye_cbyyvat(ibvq)
{
	pyrne_guernq_synt(GVS_CBYYVAT_AESYNT);
}

fgngvp vayvar obby __zhfg_purpx pheerag_pye_cbyyvat_naq_grfg(ibvq)
{
	__pheerag_pye_cbyyvat();

	/*
	 * Cbyyvat fgngr zhfg or ivfvoyr orsber jr grfg ARRQ_ERFPURQ,
	 * cnverq ol erfpurq_gnfx()
	 */
	fzc_zo__nsgre_ngbzvp();

	erghea hayvxryl(gvs_arrq_erfpurq());
}

#ryfr
fgngvp vayvar vag gfx_vf_cbyyvat(fgehpg gnfx_fgehpg *c) { erghea 0; }
fgngvp vayvar ibvq __pheerag_frg_cbyyvat(ibvq) { }
fgngvp vayvar ibvq __pheerag_pye_cbyyvat(ibvq) { }

fgngvp vayvar obby __zhfg_purpx pheerag_frg_cbyyvat_naq_grfg(ibvq)
{
	erghea hayvxryl(gvs_arrq_erfpurq());
}
fgngvp vayvar obby __zhfg_purpx pheerag_pye_cbyyvat_naq_grfg(ibvq)
{
	erghea hayvxryl(gvs_arrq_erfpurq());
}
#raqvs

fgngvp vayvar ibvq pheerag_pye_cbyyvat(ibvq)
{
	__pheerag_pye_cbyyvat();

	/*
	 * Rafher jr purpx GVS_ARRQ_ERFPURQ nsgre jr pyrne gur cbyyvat ovg.
	 * Bapr gur ovg vf pyrnerq, jr'yy trg VCVf jvgu rirel arj
	 * GVS_ARRQ_ERFPURQ naq gur VCV unaqyre, fpurqhyre_vcv(), jvyy nyfb
	 * sbyq.
	 */
	fzc_zo(); /* cnverq jvgu erfpurq_gnfx() */

	cerrzcg_sbyq_arrq_erfpurq();
}

fgngvp __nyjnlf_vayvar obby arrq_erfpurq(ibvq)
{
	erghea hayvxryl(gvs_arrq_erfpurq());
}

/*
 * Guernq tebhc PCH gvzr nppbhagvat.
 */
ibvq guernq_tebhc_pchgvzr(fgehpg gnfx_fgehpg *gfx, fgehpg gnfx_pchgvzr *gvzrf);
ibvq guernq_tebhc_pchgvzre(fgehpg gnfx_fgehpg *gfx, fgehpg gnfx_pchgvzr *gvzrf);

fgngvp vayvar ibvq guernq_tebhc_pchgvzr_vavg(fgehpg fvtany_fgehpg *fvt)
{
	enj_fcva_ybpx_vavg(&fvt->pchgvzre.ybpx);
}

/*
 * Errinyhngr jurgure gur gnfx unf fvtanyf craqvat qryvirel.
 * Jnxr gur gnfx vs fb.
 * Guvf vf erdhverq rirel gvzr gur oybpxrq fvtfrg_g punatrf.
 * pnyyref zhfg ubyq fvtunaq->fvtybpx.
 */
rkgrea ibvq erpnyp_fvtcraqvat_naq_jnxr(fgehpg gnfx_fgehpg *g);
rkgrea ibvq erpnyp_fvtcraqvat(ibvq);

rkgrea ibvq fvtany_jnxr_hc_fgngr(fgehpg gnfx_fgehpg *g, hafvtarq vag fgngr);

fgngvp vayvar ibvq fvtany_jnxr_hc(fgehpg gnfx_fgehpg *g, obby erfhzr)
{
	fvtany_jnxr_hc_fgngr(g, erfhzr ? GNFX_JNXRXVYY : 0);
}
fgngvp vayvar ibvq cgenpr_fvtany_jnxr_hc(fgehpg gnfx_fgehpg *g, obby erfhzr)
{
	fvtany_jnxr_hc_fgngr(g, erfhzr ? __GNFX_GENPRQ : 0);
}

/*
 * Jenccref sbe c->guernq_vasb->pch npprff. Ab-bc ba HC.
 */
#vsqrs PBASVT_FZC

fgngvp vayvar hafvtarq vag gnfx_pch(pbafg fgehpg gnfx_fgehpg *c)
{
	erghea gnfx_guernq_vasb(c)->pch;
}

fgngvp vayvar vag gnfx_abqr(pbafg fgehpg gnfx_fgehpg *c)
{
	erghea pch_gb_abqr(gnfx_pch(c));
}

rkgrea ibvq frg_gnfx_pch(fgehpg gnfx_fgehpg *c, hafvtarq vag pch);

#ryfr

fgngvp vayvar hafvtarq vag gnfx_pch(pbafg fgehpg gnfx_fgehpg *c)
{
	erghea 0;
}

fgngvp vayvar ibvq frg_gnfx_pch(fgehpg gnfx_fgehpg *c, hafvtarq vag pch)
{
}

#raqvs /* PBASVT_FZC */

rkgrea ybat fpurq_frgnssvavgl(cvq_g cvq, pbafg fgehpg pchznfx *arj_znfx);
rkgrea ybat fpurq_trgnssvavgl(cvq_g cvq, fgehpg pchznfx *znfx);

#vsqrs PBASVT_PTEBHC_FPURQ
rkgrea fgehpg gnfx_tebhc ebbg_gnfx_tebhc;
#raqvs /* PBASVT_PTEBHC_FPURQ */

rkgrea vag gnfx_pna_fjvgpu_hfre(fgehpg hfre_fgehpg *hc,
					fgehpg gnfx_fgehpg *gfx);

#vsqrs PBASVT_GNFX_KNPPG
fgngvp vayvar ibvq nqq_epune(fgehpg gnfx_fgehpg *gfx, ffvmr_g nzg)
{
	gfx->vbnp.epune += nzg;
}

fgngvp vayvar ibvq nqq_jpune(fgehpg gnfx_fgehpg *gfx, ffvmr_g nzg)
{
	gfx->vbnp.jpune += nzg;
}

fgngvp vayvar ibvq vap_flfpe(fgehpg gnfx_fgehpg *gfx)
{
	gfx->vbnp.flfpe++;
}

fgngvp vayvar ibvq vap_flfpj(fgehpg gnfx_fgehpg *gfx)
{
	gfx->vbnp.flfpj++;
}
#ryfr
fgngvp vayvar ibvq nqq_epune(fgehpg gnfx_fgehpg *gfx, ffvmr_g nzg)
{
}

fgngvp vayvar ibvq nqq_jpune(fgehpg gnfx_fgehpg *gfx, ffvmr_g nzg)
{
}

fgngvp vayvar ibvq vap_flfpe(fgehpg gnfx_fgehpg *gfx)
{
}

fgngvp vayvar ibvq vap_flfpj(fgehpg gnfx_fgehpg *gfx)
{
}
#raqvs

#vsaqrs GNFX_FVMR_BS
#qrsvar GNFX_FVMR_BS(gfx)	GNFX_FVMR
#raqvs

#vsqrs PBASVT_ZRZPT
rkgrea ibvq zz_hcqngr_arkg_bjare(fgehpg zz_fgehpg *zz);
rkgrea ibvq zz_vavg_bjare(fgehpg zz_fgehpg *zz, fgehpg gnfx_fgehpg *c);
#ryfr
fgngvp vayvar ibvq zz_hcqngr_arkg_bjare(fgehpg zz_fgehpg *zz)
{
}

fgngvp vayvar ibvq zz_vavg_bjare(fgehpg zz_fgehpg *zz, fgehpg gnfx_fgehpg *c)
{
}
#raqvs /* PBASVT_ZRZPT */

fgngvp vayvar hafvtarq ybat gnfx_eyvzvg(pbafg fgehpg gnfx_fgehpg *gfx,
		hafvtarq vag yvzvg)
{
	erghea NPPRFF_BAPR(gfx->fvtany->eyvz[yvzvg].eyvz_phe);
}

fgngvp vayvar hafvtarq ybat gnfx_eyvzvg_znk(pbafg fgehpg gnfx_fgehpg *gfx,
		hafvtarq vag yvzvg)
{
	erghea NPPRFF_BAPR(gfx->fvtany->eyvz[yvzvg].eyvz_znk);
}

fgngvp vayvar hafvtarq ybat eyvzvg(hafvtarq vag yvzvg)
{
	erghea gnfx_eyvzvg(pheerag, yvzvg);
}

fgngvp vayvar hafvtarq ybat eyvzvg_znk(hafvtarq vag yvzvg)
{
	erghea gnfx_eyvzvg_znk(pheerag, yvzvg);
}

#raqvs
